(()=>{var _=(()=>{let i=null,l=null,h=0,r=0,g=!0,s=()=>{h+=1},f=()=>`(${r}/${h}) [${parseInt(r/h*100).toFixed(0)}%]`;return{init:()=>{i=document.getElementById("progress-info"),l=document.getElementById("progress-bar"),i.style.display="block"},add:s,invalid:A=>{g=!1,l.style.backgroundColor="red",i.innerText=`Error loading ${A} ${f()}`},complete:A=>{g&&(r+=1,i.innerText=`Loading ${A} complete ${f()}`,l.style.width=Math.min(r/h*100,100).toString()+"%",r===h&&document.dispatchEvent(new Event("progress.done")))}}})();var w=(()=>{let i='<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>',l=o=>String(o).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),h=(o,c,a=.05)=>new Promise(p=>{let v=parseFloat(o.style.opacity),T=c?1:0,y=()=>{v+=c?a:-a,v=Math.max(0,Math.min(1,v)),o.style.opacity=v.toFixed(2),c&&v>=T||!c&&v<=T?(o.style.opacity=T.toString(),p(o)):requestAnimationFrame(y)};requestAnimationFrame(y)}),r=(o,c)=>{let a=null;a=setTimeout(()=>{o(),clearTimeout(a),a=null},c)};return{loader:i,copy:async(o,c=null,a=1500)=>{let p=o.getAttribute("data-copy");if(!p||p.length===0){alert("Nothing to copy");return}o.disabled=!0;try{await navigator.clipboard.writeText(p)}catch{o.disabled=!1,alert("Failed to copy");return}let v=o.innerHTML;o.innerHTML=c||'<i class="fa-solid fa-check"></i>',r(()=>{o.disabled=!1,o.innerHTML=v},a)},timeOut:r,debounce:(o,c)=>{let a=null;return(...p)=>{clearTimeout(a),a=setTimeout(()=>o(...p),c)}},escapeHtml:l,base64Encode:o=>{let a=new TextEncoder().encode(o);return window.btoa(String.fromCharCode(...a))},base64Decode:o=>{let c=new TextDecoder,a=Uint8Array.from(window.atob(o),p=>p.charCodeAt(0));return c.decode(a)},disableButton:(o,c="Loading",a=!1)=>{o.disabled=!0;let p=o.innerHTML;return o.innerHTML=a?c:i+c,{restore:(v=!1)=>{o.innerHTML=p,o.disabled=v}}},disableCheckbox:o=>{o.disabled=!0;let c=document.querySelector(`label[for="${o.id}"]`),a=c.innerHTML;return c.innerHTML=i+a,{restore:()=>{c.innerHTML=a,o.disabled=!1}}},parseUserAgent:o=>{let c=[{type:"Mobile",regex:/Android.*Mobile|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)|Tablet/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],a=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i}],p=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i}],v=c.find(B=>B.regex.test(o))?.type||"Unknown",T=a.find(B=>B.regex.test(o))?.name||"Unknown",y=p.find(B=>B.regex.test(o)),S=y&&o.match(y.regex)?.[1]?.replace(/_/g,".")||"",I=y?y.name:"Unknown";return S=S?`${I} ${S}`:I,`${T} ${v} ${S}`},changeOpacity:h}})();var F=(()=>{let i=(c,a,p)=>({code:c,data:a,error:p}),l=(c=0)=>({love:c}),h=({uuid:c,own:a,name:p,presence:v,comment:T,created_at:y,is_admin:S,gif_url:I,ip:B,user_agent:N,comments:e,like:n})=>({uuid:c,own:a,name:p,presence:v,comment:T,created_at:y,is_admin:S??!1,gif_url:I,ip:B,user_agent:N,comments:e?.map(h)??[],like:l(n?.love??0)});return{uuidResponse:({uuid:c})=>({uuid:c}),baseResponse:i,tokenResponse:({token:c})=>({token:c}),statusResponse:({status:c})=>({status:c}),commentResponse:({name:c,presence:a,comment:p,is_admin:v,gif_url:T,created_at:y})=>({name:c,presence:a,comment:p,is_admin:v,gif_url:T,created_at:y}),likeCommentResponse:l,getCommentResponse:h,getCommentsResponse:c=>c.map(h),commentShowMore:(c,a=!1)=>({uuid:c,show:a}),postCommentRequest:(c,a,p,v,T)=>({id:c,name:a,presence:p,comment:v,gif_id:T}),postSessionRequest:(c,a)=>({email:c,password:a}),updateCommentRequest:(c,a,p)=>({presence:c,comment:a,gif_id:p})}})();var G="GET",ne="PUT",K="POST",oe="PATCH",se="DELETE",J=200,Q=201,fe=500,z=(i,l)=>{let h=new AbortController,r=document.body.getAttribute("data-url"),g={signal:h.signal,method:String(i).toUpperCase(),headers:new Headers({Accept:"application/json","Content-Type":"application/json"})};return window.addEventListener("offline",()=>h.abort()),window.addEventListener("popstate",()=>h.abort()),window.addEventListener("beforeunload",()=>h.abort()),r&&r.slice(-1)==="/"&&(r=r.slice(0,-1)),{send(s=null){return fetch(r+l,g).then(f=>f.json().then(u=>{if(f.status>=fe&&(u.message??u[0]))throw new Error(u.message??u[0]);if(u.error)throw new Error(u.error[0]);return s&&(u.data=s(u.data)),F.baseResponse(u.code,u.data,u.error)})).catch(f=>{if(f.name==="AbortError")return console.warn("Fetch abort:",f),f;throw alert(f),new Error(f)})},download(){return fetch(r+l,g).then(s=>{if(s.status!==J)return!1;let f=document.querySelector("a[download]");f&&document.body.removeChild(f);let u=s.headers.get("content-disposition")?.match(/filename="(.+)"/)?.[1]??"download.csv";return s.blob().then(E=>{let $=document.createElement("a"),A=window.URL.createObjectURL(E);return $.href=A,$.download=u,document.body.appendChild($),$.click(),document.body.removeChild($),window.URL.revokeObjectURL(A),!0})}).catch(s=>{if(s.name==="AbortError")return console.warn("Fetch abort:",s),s;throw alert(s),new Error(s)})},withCancel(s){return(async()=>(await s,h.abort()))(),this},default(s=null){return g.headers=new Headers(s??{}),fetch(l,g)},token(s){return s.split(".").length===3?(g.headers.append("Authorization","Bearer "+s),this):(g.headers.append("x-access-key",s),this)},body(s){return g.body=JSON.stringify(s),this}}};var te=(()=>{let i=null,l=null,h=!1,r=1e3*60*60*6,g="images",s=async o=>{let c=o.getAttribute("data-src"),a="x-expiration-time",p="image/webp",v=new Image;if(v.onload=()=>{o.src=v.src,o.width=v.width,o.height=v.height,v.remove(),_.complete("image")},i.has(c)){v.src=i.get(c);return}let T=I=>new Promise((B,N)=>{let e=document.createElement("canvas");e.width=I.width,e.height=I.height,e.getContext("2d").drawImage(I,0,0);let n=d=>{d?B(d):N(new Error("Failed to convert image to WebP")),e.remove()};e.onerror=N,e.toBlob(n,p,.8)}),y=(I,B=3,N=1e3)=>z(G,c).default().then(e=>e.blob()).then(e=>window.createImageBitmap(e)).then(e=>T(e)).then(e=>{let n=new Headers;return n.set("Content-Type",p),n.set("Content-Length",String(e.size)),n.set(a,String(Date.now()+r)),I.put(c,new Response(e,{headers:n})).then(()=>e)}).catch(e=>{if(B<=0)throw e;return console.warn("Retrying fetch:"+c),new Promise(n=>w.timeOut(()=>n(y(I,B-1,N+1e3)),N))}),S=I=>I.match(c).then(B=>B?Date.now()<=parseInt(B.headers.get(a))?B.blob():I.delete(c).then(N=>N?y(I):B.blob()):y(I));await caches.open(g).then(I=>S(I)).then(I=>{v.src=URL.createObjectURL(I),i.set(c,v.src)}).catch(I=>{throw _.invalid("image"),I})},f=o=>{o.onerror=()=>_.invalid("image"),o.onload=()=>{o.width=o.naturalWidth,o.height=o.naturalHeight,_.complete("image")},o.complete&&o.naturalWidth!==0&&o.naturalHeight!==0?_.complete("image"):o.complete&&_.invalid("image")},u=()=>h,E=o=>{r=Number(o)},$=()=>{(async()=>{for(let o of l)if(o.hasAttribute("data-src"))try{await s(o)}catch{break}else f(o)})()};return{init:()=>(i=new Map,l=document.querySelectorAll("img"),l.forEach(_.add),h=Array.from(l).some(o=>o.hasAttribute("data-src")),{load:$,setTtl:E,hasDataSrc:u})}})();var Z=(()=>{let i=null,l=null,h=null,r=null,g=!1,s=1e3*60*60*6,f="audio",u="audio/mpeg",E="x-expiration-time",$='<i class="fa-solid fa-circle-pause spin-button"></i>',A='<i class="fa-solid fa-circle-play"></i>',o=async()=>{if(navigator.onLine){i.disabled=!0;try{await r,await l.play(),g=!0,i.disabled=!1,i.innerHTML=$}catch(y){g=!1,alert(y)}}},c=()=>{g=!1,l.pause(),i.innerHTML=A},a=(y,S=3,I=1e3)=>z(G,h).default().then(B=>B.blob()).then(B=>{let N=new Headers;return N.set("Content-Type",u),N.set("Content-Length",String(B.size)),N.set(E,String(Date.now()+s)),y.put(h,new Response(B,{headers:N})).then(()=>B)}).catch(B=>{if(S<=0)throw B;return console.warn("Retrying fetch:"+h),new Promise(N=>w.timeOut(()=>N(a(y,S-1,I+1e3)),I))}),p=()=>caches.open(f).then(y=>y.match(h).then(S=>S?Date.now()<=parseInt(S.headers.get(E))?S.blob():y.delete(h).then(I=>I?a(y):S.blob()):a(y))).then(y=>URL.createObjectURL(y));return{init:async()=>{i=document.getElementById("button-music"),h=i.getAttribute("data-url"),document.addEventListener("undangan.open",()=>{i.style.display="block"});try{l=new Audio(await p()),l.volume=1,l.loop=!0,l.muted=!1,l.currentTime=0,l.autoplay=!1,l.controls=!1,r=new Promise(y=>l.addEventListener("canplay",y)),_.complete("audio")}catch{_.invalid("audio")}i.addEventListener("offline",c),i.addEventListener("click",()=>g?c():o())},play:o,setTtl:y=>{s=Number(y)}}})();var ae={tab:h=>window.bootstrap.Tab.getOrCreateInstance(document.getElementById(h)),modal:h=>window.bootstrap.Modal.getOrCreateInstance(document.getElementById(h))};var C=i=>{let l=(f=null)=>{let u=JSON.parse(localStorage.getItem(i));return f?u[String(f)]:u},h=(f,u)=>{let E=l();E[String(f)]=u,localStorage.setItem(i,JSON.stringify(E))},r=f=>Object.keys(l()).includes(String(f)),g=f=>{if(!r(f))return;let u=l();delete u[String(f)],localStorage.setItem(i,JSON.stringify(u))},s=()=>localStorage.setItem(i,"{}");return localStorage.getItem(i)||s(),{set:h,get:l,has:r,clear:s,unset:g}};var Y=(()=>{let i={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},l=["#ffffff","#f8f9fa"],h=["#000000","#212529"],r=!1,g=null,s=null,f=()=>g.set("active","light"),u=()=>g.set("active","dark"),E=T=>{let y=s.getAttribute("content");s.setAttribute("content",T.some(S=>S===y)?i[y]:y)},$=()=>{f(),document.documentElement.setAttribute("data-bs-theme","light"),E(h)},A=()=>{u(),document.documentElement.setAttribute("data-bs-theme","dark"),E(l)},o=(T=null,y=null)=>{let S=g.get("active")==="dark";return T&&y?S?T:y:S};return{init:()=>{switch(g=C("theme"),s=document.querySelector('meta[name="theme-color"]'),g.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?u():f()),document.documentElement.getAttribute("data-bs-theme")){case"dark":u();break;case"light":f();break;default:r=!0}o()?A():$()},spyTop:()=>{let T=S=>S.filter(I=>I.isIntersecting).forEach(I=>{let B=I.target.classList.contains("bg-white-black")?o(h[0],l[0]):o(h[1],l[1]);s.setAttribute("content",B)}),y=new IntersectionObserver(T,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(S=>y.observe(S))},change:()=>o()?$():A(),isDarkMode:o,isAutoMode:()=>r}})();var q=(()=>{let i=null,l=()=>i.get("token"),h=$=>i.set("token",$),r=$=>z(K,"/api/session").body($).send(F.tokenResponse).then(A=>(A.code===J&&h(A.data.token),A.code===J),()=>!1),g=()=>i.unset("token"),s=()=>String(l()??".").split(".").length===3;return{init:()=>{i=C("session")},guest:()=>z(G,"/api/config").token(l()).send().then($=>{if($.code!==J)throw new Error("failed to get config.");let A=C("config");for(let[o,c]of Object.entries($.data))A.set(o,c);return $}),login:r,logout:g,decode:()=>{if(!s())return null;try{return JSON.parse(window.atob(l().split(".")[1]))}catch{return null}},isAdmin:s,setToken:h,getToken:l}})();var ie=(()=>{let i=null,l=!0,h=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"],r=()=>l,g=()=>{let o=i.firstElementChild.firstElementChild;o.classList.remove("bg-success"),o.classList.add("bg-danger"),o.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},s=()=>{let o=i.firstElementChild.firstElementChild;o.classList.remove("bg-danger"),o.classList.add("bg-success"),o.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},f=async()=>{l&&(await w.changeOpacity(i,!1),g())},u=()=>{document.querySelectorAll(h.join(", ")).forEach(o=>{o.dispatchEvent(new Event(r()?"online":"offline")),o.setAttribute("data-offline-disabled",r()?"false":"true"),o.tagName==="BUTTON"?r()?o.classList.remove("disabled"):o.classList.add("disabled"):r()?o.removeAttribute("disabled"):o.setAttribute("disabled","true")})},E=()=>{l=!1,g(),w.changeOpacity(i,!0),u()},$=()=>{l=!0,s(),w.timeOut(f,3e3),u()};return{init:()=>{window.addEventListener("online",$),window.addEventListener("offline",E),i=document.getElementById("offline-mode"),i.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`},isOnline:r}})();var D=(()=>{let i="gifs",l="default",h={128:2,256:3,512:4,768:5},r={id:"ID",en:"US",fr:"FR",de:"DE",es:"ES",zh:"CN",ja:"JP",ko:"KR",ar:"SA",ru:"RU",it:"IT",nl:"NL",pt:"PT",tr:"TR",th:"TH",vi:"VN",ms:"MY",hi:"IN"},g=null,s=null,f=null,u=null,E=async t=>{if(g.has(t))return g.get(t);let m=(x,P=3,R=1e3)=>z(G,t).default().then(O=>O.blob().then(M=>x.put(t,new Response(M,{headers:new Headers(O.headers)})).then(()=>M))).catch(O=>{if(P<=0)throw O;return console.warn("Retrying fetch:"+t),new Promise(M=>w.timeOut(()=>M(m(x,P-1,R+1e3)),R))}),L=x=>x.match(t).then(P=>{if(!P)return m(x);let R=P.headers.get("expires"),O=R?new Date(R).getTime():0;return Date.now()>O?x.delete(t).then(M=>M?m(x):P.blob()):P.blob()});return await caches.open(i).then(x=>L(x)).then(x=>URL.createObjectURL(x)).then(x=>(g.set(t,x),x))},$=async(t,m)=>{let{id:L,media_formats:{tinygif:{url:H}},content_description:x}=m;t.pointer===-1||t.pointer===t.col-1?t.pointer=0:t.pointer++;let P=0;for(let R of t.lists.childNodes){if(P===t.pointer){await E(H).then(O=>{R.insertAdjacentHTML("beforeend",`
                    <figure class="gif-figure m-0 position-relative">
                        <div onclick="undangan.comment.gif.click('${t.uuid}', '${L}', '${w.base64Encode(H)}')" class="gif-checklist position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-1 m-1 rounded-circle border shadow-sm z-1">
                            <i class="fa-solid fa-circle-check"></i>
                        </div>
                        <img src="${O}" class="img-fluid" alt="${w.escapeHtml(x)}" style="width: 100%;">
                    </figure>`)});break}P++}},A=t=>{let m=t.lists,L=document.getElementById(`gif-loading-${t.uuid}`),H=document.getElementById(`progress-bar-${t.uuid}`),x=document.getElementById(`progress-info-${t.uuid}`),P=0,R=0;return x.innerText=`${R}/${P}`,m.classList.contains("d-none")||L.classList.replace("d-none","d-flex"),m.setAttribute("data-continue","false"),m.classList.replace("overflow-y-scroll","overflow-y-hidden"),{release:()=>{x.innerText=`${R}/${P}`,H.style.width="0%",m.classList.contains("d-none")||L.classList.replace("d-flex","d-none"),m.setAttribute("data-continue","true"),m.classList.replace("overflow-y-hidden","overflow-y-scroll")},until:j=>{P=j,x.innerText=`${R}/${P}`},step:()=>{R+=1,x.innerText=`${R}/${P}`,H.style.width=Math.min(R/P*100,100).toString()+"%"}}},o=(t,m,L)=>{L={media_filter:"tinygif",client_key:"undangan_app",key:u.get("tenor_key"),country:u.get("country"),locale:u.get("locale"),...L??{}};let H=Object.keys(L).filter(R=>L[R]!==null&&L[R]!==void 0).map(R=>`${R}=${encodeURIComponent(L[R])}`).join("&"),x=`https://tenor.googleapis.com/v2${m}?${H}`,P=new Promise(R=>{t.reqs.push(R)});t.last=new Promise(R=>{let O=!0;(async()=>(await P,O=!1))(),(async()=>{let M=A(t);try{let U=await z(G,x).withCancel(P).default().then(j=>j.json()).then(j=>{if(!j.error)return j;throw new Error(j.error.message)});t.next=U?.next,M.until(U.results.length);for(let j of U.results)try{O&&(t.gifs.push(j),await $(t,j),M.step())}catch(ue){throw O=!1,ue}}catch(U){O=!1,U.name==="AbortError"?console.warn("Fetch abort:",U):alert(U)}finally{M.release(),R()}})()})},c=t=>`
        <label for="gif-search-${t}" class="form-label my-1"><i class="fa-solid fa-photo-film me-2"></i>Gif</label>

        <div class="d-flex mb-3" id="gif-search-nav-${t}">
            <button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1" onclick="undangan.comment.gif.back(this, '${t}')" data-offline-disabled="false"><i class="fa-solid fa-arrow-left"></i></button>
            <input type="text" name="gif-search" id="gif-search-${t}" autocomplete="on" class="form-control shadow-sm rounded-4" placeholder="Cari GIF oleh Tenor" data-offline-disabled="false">
        </div>

        <div class="position-relative">
            <div class="position-absolute d-flex flex-column justify-content-center align-items-center top-50 start-50 translate-middle w-100 h-100 bg-overlay-auto rounded-4 z-3" id="gif-loading-${t}">
                <div class="progress w-25" role="progressbar" style="height: 0.5rem;" aria-label="progress bar">
                    <div class="progress-bar" id="progress-bar-${t}" style="width: 0%"></div>
                </div>
                <small class="mt-1 text-theme-auto bg-theme-auto py-0 px-2 rounded-4" id="progress-info-${t}" style="font-size: 0.7rem;"></small>
            </div>
            <div id="gif-lists-${t}" class="d-flex rounded-4 p-0 overflow-y-scroll border" data-continue="true" style="height: 15rem;"></div>
        </div>

        <figure class="d-flex m-0 position-relative" id="gif-result-${t}">
            <div onclick="undangan.comment.gif.cancel('${t}')" id="gif-cancel-${t}" class="d-none position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-2 m-1 rounded-circle border shadow-sm z-1" style="cursor: pointer;">
                <i class="fa-solid fa-circle-xmark"></i>
            </div>
        </figure>`,a=async t=>{let m=0;for(let[H,x]of Object.entries(h))m=x,t.lists.clientWidth>=parseInt(H)&&(t.col=m);if(t.col===null&&(t.col=m),t.pointer=-1,t.limit=t.col*5,t.lists.innerHTML='<div class="d-flex flex-column"></div>'.repeat(t.col),t.gifs.length===0)return;let L=A(t);L.until(t.gifs.length);for(let H of t.gifs)try{await $(t,H),L.step()}catch{t.gifs=[];break}L.release(),t.gifs.length===0&&await a(t)},p=async t=>{t.reqs.forEach(m=>m()),t.reqs=[],t.last&&(await t.last,t.last=null)},v=async t=>{if(t.lists.getAttribute("data-continue")!=="true"||!t.next||t.next.length===0)return;let m=t.query&&t.query.trim().length>0,L={pos:t.next,limit:t.limit};m&&(L.q=t.query),t.lists.scrollTop>(t.lists.scrollHeight-t.lists.clientHeight)*.9&&(await p(t),o(t,m?"/search":"/featured",L))},T=async(t,m)=>{await p(t),t.query=m.value,(!t.query||t.query.trim().length===0)&&(t.query=null),t.next=null,t.gifs=[],t.pointer=-1,await a(t),o(t,t.query===null?"/featured":"/search",{q:t.query,limit:t.limit})},y=t=>{if(!s.has(t)){document.getElementById(`gif-form-${t}`).innerHTML=c(t),s.set(t,{uuid:t,last:null,limit:null,query:null,next:null,col:null,pointer:-1,gifs:[],reqs:[],lists:document.getElementById(`gif-lists-${t}`)});let m=s.get(t),L=w.debounce(a,750),H=w.debounce(T,750);window.addEventListener("resize",()=>L(m)),m.lists.addEventListener("scroll",()=>v(m)),document.getElementById(`gif-search-${t}`).addEventListener("input",x=>H(m,x.target))}return s.get(t)};return{default:l,init:()=>{g=new Map,f=new Map,s=new Map,u=C("config");let t=document.documentElement.lang.toLowerCase();u.set("country",r[t]??"US"),u.set("locale",`${t}_${u.get("country")}`),u.get("tenor_key")===null&&document.querySelector('[onclick="undangan.comment.gif.open(undangan.comment.gif.default)"]')?.remove()},cache:E,back:async(t,m)=>{let L=w.disableButton(t,w.loader.replace("me-1","me-0"),!0);await p(s.get(m)),L.restore(),document.getElementById(`gif-form-${m}`).classList.toggle("d-none",!0),document.getElementById(`comment-form-${m}`)?.classList.toggle("d-none",!1)},open:async t=>{let m=y(t);document.getElementById(`gif-form-${t}`).classList.toggle("d-none",!1),document.getElementById(`comment-form-${t}`)?.classList.toggle("d-none",!0),f.has(t)&&f.get(t)(),await p(m),await a(m),o(m,"/featured",{limit:m.limit})},cancel:t=>{let m=document.getElementById(`gif-result-${t}`);m.removeAttribute("data-id"),m.querySelector(`#gif-cancel-${t}`).classList.replace("d-flex","d-none"),m.querySelector("img").remove(),s.get(t).lists.classList.replace("d-none","d-flex"),document.getElementById(`gif-search-nav-${t}`).classList.replace("d-none","d-flex")},click:(t,m,L)=>{let H=document.getElementById(`gif-result-${t}`);H.setAttribute("data-id",m),H.querySelector(`#gif-cancel-${t}`).classList.replace("d-none","d-flex"),H.insertAdjacentHTML("beforeend",`<img src="${g.get(w.base64Decode(L))}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">`),s.get(t).lists.classList.replace("d-flex","d-none"),document.getElementById(`gif-search-nav-${t}`).classList.replace("d-flex","d-none")},remove:async(t=null)=>{t?s.has(t)&&(await p(s.get(t)),s.delete(t),f.delete(t)):(await Promise.all(Array.from(s.keys()).map(m=>p(s.get(m)))),s.clear(),f.clear())},isOpen:t=>{let m=document.getElementById(`gif-form-${t}`);return m===null?!1:!m.classList.contains("d-none")},onOpen:(t,m)=>f.set(t,m),getResultId:t=>document.getElementById(`gif-result-${t}`)?.getAttribute("data-id")}})();var V=(()=>{let i=null,l=null,h=null,r=null,g=null,s=null,f=300,u=[["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']],E=()=>`
        <div class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4">
            <div class="d-flex justify-content-between align-items-center placeholder-wave">
                <span class="placeholder bg-secondary col-5 rounded-3 my-1"></span>
                <span class="placeholder bg-secondary col-3 rounded-3 my-1"></span>
            </div>
            <hr class="my-1">
            <p class="placeholder-wave m-0">
                <span class="placeholder bg-secondary col-6 rounded-3"></span>
                <span class="placeholder bg-secondary col-5 rounded-3"></span>
                <span class="placeholder bg-secondary col-12 rounded-3 my-1"></span>
            </p>
        </div>`,$=e=>(u.forEach(n=>{let d=n[0],b=n[1];e=e.replace(new RegExp(`\\${d}(?=\\S)(.*?)(?<!\\s)\\${d}`,"gs"),b)}),e),A=e=>`
        <button style="font-size: 0.8rem;" onclick="undangan.comment.like.love(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto ms-auto rounded-3 p-0 shadow-sm d-flex justify-content-start align-items-center" data-offline-disabled="false">
            <span class="my-0 mx-1" data-count-like="${e.like.love}">${e.like.love}</span>
            <i class="me-1 ${h.has(e.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
        </button>`,o=e=>{let n=e.gif_url!==null&&e.gif_url!==void 0,d=`<div class="d-flex justify-content-start align-items-center" data-button-action="${e.uuid}">`;return(r.get("can_reply")===!0||r.get("can_reply")===void 0)&&(d+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.reply(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Reply</button>`),l.has(e.uuid)&&(r.get("can_edit")===!0||r.get("can_edit")===void 0)&&!(n&&r.get("tenor_key")===null)&&(d+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Edit</button>`),q.isAdmin()?d+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Delete</button>`:l.has(e.uuid)&&(r.get("can_delete")===!0||r.get("can_delete")===void 0)&&(d+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Delete</button>`),d+="</div>",d},c=(e,n)=>{let d=s.get("show").includes(e);return`<a class="text-theme-auto" style="font-size: 0.8rem;" onclick="undangan.comment.showOrHide(this)" data-uuid="${e}" data-uuids="${n.join(",")}" data-show="${d?"true":"false"}" role="button" class="me-auto ms-1 py-0">${d?"Hide replies":`Show replies (${n.length})`}</a>`},a=e=>`
        <div class="d-flex justify-content-between align-items-center" id="button-${e.uuid}">
            ${o(e)}
            ${e.comments.length>0?c(e.uuid,e.comments.map(n=>n.uuid)):""}
            ${A(e)}
        </div>`,p=e=>e.ip===void 0||e.user_agent===void 0||e.is_admin?"":`
        <div class="mb-1 mt-3">
            <p class="text-theme-auto mb-1 mx-0 mt-0 p-0" style="font-size: 0.7rem;" id="ip-${e.uuid}"><i class="fa-solid fa-location-dot me-1"></i>${w.escapeHtml(e.ip)} ${g.has(e.ip)?`<strong>${g.get(e.ip)}</strong>`:'<span class="mb-1 placeholder col-2 rounded-3"></span>'}</p>
            <p class="text-theme-auto m-0 p-0" style="font-size: 0.7rem;"><i class="fa-solid fa-mobile-screen-button me-1"></i>${w.parseUserAgent(w.escapeHtml(e.user_agent))}</p>
        </div>`,v=(e,n)=>n?'class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4" data-parent="true"':`class="${s.get("hidden").find(d=>d.uuid===e.uuid).show?"":"d-none"} overflow-x-scroll mw-100 border-start bg-theme-auto py-2 ps-2 pe-0 my-2 ms-2 me-0"`,T=(e,n)=>e.is_admin?`<strong class="me-1">${w.escapeHtml(i.get("name")??r.get("name"))}</strong><i class="fa-solid fa-certificate text-primary"></i>`:n?`<strong class="me-1">${w.escapeHtml(e.name)}</strong><i id="badge-${e.uuid}" class="fa-solid ${e.presence?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>`:`<strong>${w.escapeHtml(e.name)}</strong>`,y=async(e,n)=>{let d=`
        <div class="d-flex justify-content-between align-items-center">
            <p class="text-theme-auto text-truncate m-0 p-0" style="font-size: 0.95rem;">${T(e,n)}</p>
            <small class="text-theme-auto m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
        </div>
        <hr class="my-1">`;if(e.gif_url!==null&&e.gif_url!==void 0)return d+`
            <div class="d-flex justify-content-center align-items-center my-2">
                <img src="${await D.cache(e.gif_url)}" id="img-gif-${e.uuid}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">
            </div>`;let b=$(w.escapeHtml(e.comment)),k=b.length>f;return d+`
        <p class="text-theme-auto my-1 mx-0 p-0" style="white-space: pre-wrap !important; font-size: 0.95rem;" ${k?`data-comment="${w.base64Encode(b)}"`:""} id="content-${e.uuid}">${k?b.slice(0,f)+"...":b}</p>
        ${k?`<p class="d-block mb-2 mt-0 mx-0 p-0"><a class="text-theme-auto" role="button" style="font-size: 0.85rem; display: block;" data-show="false" onclick="undangan.comment.showMore(this, '${e.uuid}')">Selengkapnya</a></p>`:""}`},S=async(e,n)=>{let d=await y(e,n),b="";for(let k of e.comments)b+=await S(k,!1);return`
        <div ${v(e,n)} id="${e.uuid}" style="overflow-wrap: break-word !important;">
            <div id="body-content-${e.uuid}" data-tapTime="0" data-liked="false" tabindex="0">${d}</div>
            ${p(e)}
            ${a(e)}
            <div id="reply-content-${e.uuid}">${b}</div>
        </div>`};return{init:()=>{i=C("user"),l=C("owns"),h=C("likes"),r=C("config"),g=C("tracker"),s=C("comment")},renderEdit:(e,n,d,b)=>{let k=document.createElement("div");return k.classList.add("my-2"),k.id=`inner-${e}`,k.innerHTML=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-pen me-2"></i>Edit</p>
        ${d?`
        <select class="form-select shadow-sm mb-2 rounded-4" id="form-inner-presence-${e}" data-offline-disabled="false">
            <option value="1" ${n?"selected":""}>Datang</option>
            <option value="2" ${n?"":"selected"}>Berhalangan</option>
        </select>`:""}
        ${b?`${r.get("tenor_key")===null?"":`<div class="d-none mb-2" id="gif-form-${e}"></div>`}`:`<textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type update comment" rows="3" data-offline-disabled="false"></textarea>    
        `}
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel('${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.update(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Update</button>
        </div>`,k},renderReply:e=>{let n=document.createElement("div");return n.classList.add("my-2"),n.id=`inner-${e}`,n.innerHTML=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-reply me-2"></i>Reply</p>
        <div class="d-block mb-2" id="comment-form-${e}">
            <div class="position-relative">
                ${r.get("tenor_key")===null?"":`<button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1 position-absolute bottom-0 end-0" onclick="undangan.comment.gif.open('${e}')" aria-label="button gif" data-offline-disabled="false"><i class="fa-solid fa-photo-film"></i></button>`}
                <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type reply comment" rows="3" data-offline-disabled="false"></textarea>
            </div>
        </div>
        <div class="d-none mb-2" id="gif-form-${e}"></div>
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel('${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.send(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Send</button>
        </div>`,n},renderLoading:E,renderReadMore:c,renderInnerContent:e=>S(e,!1),renderContent:e=>S(e,!0),convertMarkdownToHTML:$,maxCommentLength:f}})();var re=()=>window.confetti.shapeFromPath({path:"M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z",matrix:[.03333333333333333,0,0,.03333333333333333,-5.566666666666666,-5.533333333333333]}),le=()=>{window.confetti({origin:{y:1},zIndex:1057})},ce=(i=15)=>{let l=i*1e3,h=Date.now()+l,r=re(),g=["#FFC0CB","#FF1493","#C71585"],s=(u,E)=>Math.random()*(E-u)+u,f=()=>{let u=h-Date.now();g.forEach(E=>{window.confetti({particleCount:1,startVelocity:0,ticks:Math.max(50,75*(u/l)),origin:{x:Math.random(),y:Math.abs(Math.random()-u/l)},zIndex:1057,colors:[E],shapes:[r],drift:s(-.5,.5),gravity:s(.5,1),scalar:s(.5,1)})}),u>0&&requestAnimationFrame(f)};requestAnimationFrame(f)},de=i=>{if(!window.confetti)return;let l=Date.now()+25,h=Math.max(.3,Math.min(1,i.getBoundingClientRect().top/window.innerHeight+.2)),r=re(),g=["#FF69B4","#FF1493"],s=()=>{g.forEach(f=>{window.confetti({particleCount:2,angle:60,spread:55,shapes:[r],origin:{x:0,y:h},zIndex:1057,colors:[f]}),window.confetti({particleCount:2,angle:120,spread:55,shapes:[r],origin:{x:1,y:h},zIndex:1057,colors:[f]})}),Date.now()<l&&requestAnimationFrame(s)};requestAnimationFrame(s)};var X=(()=>{let i=null,l=async s=>{let f=s.firstElementChild,u=s.lastElementChild,E=s.getAttribute("data-uuid"),$=parseInt(f.getAttribute("data-count-like"));s.disabled=!0,navigator.vibrate&&navigator.vibrate(100),i.has(E)?await z(oe,"/api/comment/"+i.get(E)).token(q.getToken()).send(F.statusResponse).then(A=>{A.data.status&&(i.unset(E),u.classList.remove("fa-solid","text-danger"),u.classList.add("fa-regular"),f.setAttribute("data-count-like",String($-1)))}):await z(K,"/api/comment/"+E).token(q.getToken()).send(F.uuidResponse).then(A=>{A.code===Q&&(i.set(E,A.data.uuid),u.classList.remove("fa-regular"),u.classList.add("fa-solid","text-danger"),f.setAttribute("data-count-like",String($+1)))}),f.innerText=f.getAttribute("data-count-like"),s.disabled=!1},h=s=>document.querySelector(`button[onclick="undangan.comment.like.love(this)"][data-uuid="${s}"]`);return{init:()=>{i=C("likes")},love:l,tapTap:async s=>{if(!navigator.onLine)return;let f=Date.now(),u=f-parseInt(s.getAttribute("data-tapTime")),E=s.id.replace("body-content-",""),$=u<300&&u>0,A=!i.has(E)&&s.getAttribute("data-liked")!=="true";$&&A&&(de(s),s.setAttribute("data-liked","true"),await l(h(E)),s.setAttribute("data-liked","false")),s.setAttribute("data-tapTime",f)},getButtonLike:h}})();var W=(()=>{let i=10,l=0,h=0,r=null,g=null,s=null,f=null,u=null,E=n=>{i=Number(n)},$=()=>i,A=()=>l,o=()=>h,c=()=>g.classList.contains("disabled")?null:g.classList.add("disabled"),a=()=>g.classList.contains("disabled")?g.classList.remove("disabled"):null,p=()=>s.classList.contains("disabled")?null:s.classList.add("disabled"),v=()=>s.classList.contains("disabled")?s.classList.remove("disabled"):null,T=()=>{f.classList.contains("d-none")&&f.classList.remove("d-none")},y=n=>{n.disabled=!0;let d=n.innerHTML;n.innerHTML=w.loader.replace("ms-0 me-1","mx-1");let b=async()=>{let m=new Promise(L=>u.addEventListener("comment.result",L,{once:!0}));u.dispatchEvent(new Event("comment.show")),await m,n.disabled=!1,n.innerHTML=d,u.scrollIntoView({behavior:"smooth"})};return{next:async()=>{l+=i,n.innerHTML="Next"+n.innerHTML,await b(),r.innerText=String(parseInt(r.innerText)+1)},prev:async()=>{l-=i,n.innerHTML=n.innerHTML+"Prev",await b(),r.innerText=String(parseInt(r.innerText)-1)}}};return{init:()=>{f=document.getElementById("pagination"),f.innerHTML=`
        <ul class="pagination mb-2 shadow-sm rounded-4">
            <li class="page-item disabled" id="previous">
                <button class="page-link rounded-start-4" onclick="undangan.comment.pagination.previous(this)" data-offline-disabled="false">
                    <i class="fa-solid fa-circle-left me-1"></i>Prev
                </button>
            </li>
            <li class="page-item disabled">
                <span class="page-link text-theme-auto" id="page">1</span>
            </li>
            <li class="page-item" id="next">
                <button class="page-link rounded-end-4" onclick="undangan.comment.pagination.next(this)" data-offline-disabled="false">
                    Next<i class="fa-solid fa-circle-right ms-1"></i>
                </button>
            </li>
        </ul>`,u=document.getElementById("comments"),r=document.getElementById("page"),g=document.getElementById("previous"),s=document.getElementById("next")},setPer:E,getPer:$,getNext:A,reset:()=>l===0?!1:(l=0,h=0,r.innerText=1,p(),c(),!0),setResultData:n=>{if(h=n,l>0&&a(),h<i){p();return}v(),T()},getResultData:o,previous:async n=>{c(),!(l<0)&&(p(),await y(n).prev())},next:async n=>{p(),!(h<i)&&(c(),await y(n).next())}}})();var ee=(()=>{let i=null,l=null,h=null,r=null,g=null,s=[],f=()=>'<div class="text-center p-4 my-2 bg-theme-auto rounded-4 shadow"><p class="fw-bold p-0 m-0" style="font-size: 0.95rem;">Yuk bagikan undangan ini biar banyak komentarnya</p></div>',u=(e,n)=>{document.querySelector(`[data-button-action="${e}"]`).childNodes.forEach(d=>{d.disabled=n})},E=e=>{u(e,!1),document.getElementById(`inner-${e}`).remove()},$=e=>{e.comments&&e.comments.forEach($);let n=document.getElementById(`body-content-${e.uuid}`);n.addEventListener("touchend",()=>X.tapTap(n))},A=e=>{if(!q.isAdmin()||(e.comments&&e.comments.forEach(A),e.ip===void 0||e.user_agent===void 0||e.is_admin||h.has(e.ip)))return;let n=(d,b,k)=>{document.getElementById(`ip-${d}`).innerHTML=`<i class="fa-solid fa-location-dot me-1"></i>${w.escapeHtml(b)} <strong>${w.escapeHtml(k)}</strong>`};z(G,`https://freeipapi.com/api/json/${e.ip}`).default().then(d=>d.json()).then(d=>{let b=d.cityName+" - "+d.regionName;d.cityName==="-"&&d.regionName==="-"&&(b="localhost"),h.set(e.ip,b),n(e.uuid,e.ip,b)}).catch(d=>n(e.uuid,e.ip,d.message))},o=(e,n=[])=>(e.forEach(d=>{n.find(b=>b.uuid===d.uuid)||n.push(F.commentShowMore(d.uuid)),d.comments&&d.comments.length>0&&o(d.comments,n)}),n),c=()=>(g.getAttribute("data-loading")==="false"&&(g.setAttribute("data-loading","true"),g.innerHTML=V.renderLoading().repeat(W.getPer())),z(G,`/api/comment?per=${W.getPer()}&next=${W.getNext()}`).token(q.getToken()).send(F.getCommentsResponse).then(async e=>{let n=e.data.length;g.setAttribute("data-loading","false");for(let b of s.map(k=>k.uuid))await D.remove(b);if(n===0)return W.setResultData(n),g.innerHTML=f(),e;s=o(e.data),r.set("hidden",o(e.data,r.get("hidden")));let d="";for(let b of e.data)d+=await V.renderContent(b);return g.innerHTML=d,e.data.forEach(A),e.data.forEach($),W.setResultData(n),g.dispatchEvent(new Event("comment.result")),e})),a=e=>{let n=e.getAttribute("data-uuids").split(","),d=e.getAttribute("data-show")==="true",b=e.getAttribute("data-uuid");d?(e.setAttribute("data-show","false"),e.innerText=`Show replies (${n.length})`,r.set("show",r.get("show").filter(k=>k!==b))):(e.setAttribute("data-show","true"),e.innerText="Hide replies",r.set("show",r.get("show").concat([b])));for(let k of n){r.set("hidden",r.get("hidden").map(m=>(m.uuid===k&&(m.show=!d),m)));let t=document.getElementById(k).classList;d?t.add("d-none"):t.remove("d-none")}};return{gif:D,like:X,pagination:W,init:()=>{D.init(),X.init(),V.init(),W.init(),g=document.getElementById("comments"),g.addEventListener("comment.show",c),i=C("owns"),l=C("user"),h=C("tracker"),r=C("comment"),r.has("hidden")||r.set("hidden",[]),r.has("show")||r.set("show",[])},send:async e=>{let n=e.getAttribute("data-uuid"),d=document.getElementById("form-name"),b=d.value;if(q.isAdmin()&&(b=l.get("name")),b.length===0){alert("Name cannot be empty."),n&&document.getElementById("comment").scrollIntoView({behavior:"smooth"});return}let k=document.getElementById("form-presence");if(!n&&k&&k.value==="0"){alert("Please select your attendance status.");return}let t=D.isOpen(n||"default"),m=D.getResultId(n||"default"),L=document.getElementById(`gif-cancel-${n||"default"}`);if(t&&!m){alert("Gif cannot be empty.");return}t&&m&&L.classList.replace("d-flex","d-none");let H=document.getElementById(`form-${n?`inner-${n}`:"comment"}`);if(!t&&H.value.length===0){alert("Comments cannot be empty.");return}!n&&d&&!q.isAdmin()&&(d.disabled=!0),!q.isAdmin()&&k&&k.value!=="0"&&(k.disabled=!0),H&&(H.disabled=!0);let x=document.querySelector(`[onclick="undangan.comment.cancel('${n}')"]`);x&&(x.disabled=!0);let P=w.disableButton(e),R=k?k.value==="1":!0;if(!q.isAdmin()){let M=C("information");M.set("name",b),n||M.set("presence",R)}let O=await z(K,"/api/comment").token(q.getToken()).body(F.postCommentRequest(n,b,R,D.isOpen(n)?null:H.value,m)).send(F.getCommentResponse).then(M=>M,()=>null);if(d&&(d.disabled=!1),H&&(H.disabled=!1),x&&(x.disabled=!1),k&&(k.disabled=!1),t&&m&&L.classList.replace("d-none","d-flex"),P.restore(),!(!O||O.code!==Q)){if(i.set(O.data.uuid,O.data.own),H&&(H.value=null),t&&m&&L.dispatchEvent(new Event("click")),!n){if(W.reset()){await c(),g.scrollIntoView({behavior:"smooth"});return}W.setResultData(g.children.length),W.getResultData()===W.getPer()&&g.lastElementChild.remove(),O.data.is_admin=q.isAdmin();let M=await V.renderContent(O.data);g.insertAdjacentHTML("afterbegin",M),g.scrollIntoView({behavior:"smooth"})}if(n){r.set("hidden",r.get("hidden").concat([F.commentShowMore(O.data.uuid,!0)])),r.set("show",r.get("show").concat([n])),E(n),O.data.is_admin=q.isAdmin(),document.getElementById(`reply-content-${n}`).insertAdjacentHTML("beforeend",await V.renderInnerContent(O.data));let M=document.getElementById(`button-${n}`).querySelector("a"),U=[O.data.uuid];M&&(M.getAttribute("data-show")==="false"&&a(M),M.remove()),X.getButtonLike(n).insertAdjacentHTML("beforebegin",V.renderReadMore(n,M?M.getAttribute("data-uuids").split(",").concat(U):U))}$(O.data)}},edit:async e=>{let n=e.getAttribute("data-uuid");if(document.getElementById(`inner-${n}`))return;u(n,!0);let d=w.disableButton(e);await z(G,"/api/comment/"+n).token(q.getToken()).send(F.commentResponse).then(async b=>{if(b.code!==J)return b;let k=b.data.gif_url!==null&&b.data.gif_url!==void 0;k&&await D.remove(n);let t=document.getElementById(n).getAttribute("data-parent")==="true"&&!q.isAdmin();if(document.getElementById(`button-${n}`).insertAdjacentElement("afterend",V.renderEdit(n,b.data.presence,t,k)),k)return D.onOpen(n,()=>{document.querySelector(`[for="gif-search-${n}"]`)?.remove(),document.querySelector(`[onclick="undangan.comment.gif.back(this, '${n}')"]`)?.remove()}),D.open(n);let m=document.getElementById(`form-inner-${n}`);return m.value=b.data.comment,m.setAttribute("data-original",w.base64Encode(b.data.comment)),b}),d.restore(!0)},reply:async e=>{let n=e.getAttribute("data-uuid");document.getElementById(`inner-${n}`)||(u(n,!0),await D.remove(n),D.onOpen(n,()=>document.querySelector(`[for="gif-search-${n}"]`)?.remove()),document.getElementById(`button-${n}`).insertAdjacentElement("afterend",V.renderReply(n)))},remove:async e=>{if(!confirm("Are you sure?"))return;let n=e.getAttribute("data-uuid");q.isAdmin()&&i.set(n,e.getAttribute("data-own")),u(n,!0);let d=w.disableButton(e),b=X.getButtonLike(n);if(b.disabled=!0,!await z(se,"/api/comment/"+i.get(n)).token(q.getToken()).send(F.statusResponse).then(t=>t.data.status,()=>!1)){d.restore(),b.disabled=!1;return}document.querySelectorAll('a[onclick="undangan.comment.showOrHide(this)"]').forEach(t=>{let m=t.getAttribute("data-uuids").split(",");if(m.find(L=>L===n)){let L=m.filter(H=>H!==n).join(",");L.length===0?t.remove():t.setAttribute("data-uuids",L)}}),i.unset(n),document.getElementById(n).remove(),g.children.length===0&&(g.innerHTML=f())},update:async e=>{let n=e.getAttribute("data-uuid"),d=!1,b=document.getElementById(`form-inner-presence-${n}`);b&&(b.disabled=!0,d=b.value==="1");let k=!1,t=document.getElementById(`badge-${n}`);t&&(k=t.classList.contains("text-success"));let m=D.isOpen(n),L=D.getResultId(n),H=document.getElementById(`gif-cancel-${n}`),x=document.getElementById(`form-inner-${n}`);if(m&&L&&H.classList.replace("d-flex","d-none"),n&&!m&&w.base64Encode(x.value)===x.getAttribute("data-original")&&k===d){E(n);return}x&&(x.disabled=!0);let P=document.querySelector(`[onclick="undangan.comment.cancel('${n}')"]`);P&&(P.disabled=!0);let R=w.disableButton(e),O=await z(ne,"/api/comment/"+i.get(n)).token(q.getToken()).body(F.updateCommentRequest(b?d:null,D.isOpen(n)?null:x.value,L)).send(F.statusResponse).then(M=>M.data.status,()=>!1);if(x&&(x.disabled=!1),P&&(P.disabled=!1),b&&(b.disabled=!1),R.restore(),m&&L&&H.classList.replace("d-none","d-flex"),!!O){if(m&&L&&(document.getElementById(`img-gif-${n}`).src=document.getElementById(`gif-result-${n}`)?.querySelector("img").src,H.dispatchEvent(new Event("click"))),E(n),!m){let M=document.querySelector(`[onclick="undangan.comment.showMore(this, '${n}')"]`),U=V.convertMarkdownToHTML(w.escapeHtml(x.value)),j=document.getElementById(`content-${n}`);U.length>V.maxCommentLength?(j.innerHTML=M?.getAttribute("data-show")==="false"?U.slice(0,V.maxCommentLength)+"...":U,j.setAttribute("data-comment",w.base64Encode(U)),M?.classList.replace("d-none","d-block")):(j.innerHTML=U,j.removeAttribute("data-comment"),M?.classList.replace("d-block","d-none"))}if(b&&(document.getElementById("form-presence").value=d?"1":"2",C("information").set("presence",d)),!(!b||!t)){if(d){t.classList.remove("fa-circle-xmark","text-danger"),t.classList.add("fa-circle-check","text-success");return}t.classList.remove("fa-circle-check","text-success"),t.classList.add("fa-circle-xmark","text-danger")}}},cancel:e=>{let n=document.getElementById(`form-inner-presence-${e}`),d=n?n.value==="1":!1,b=document.getElementById(`badge-${e}`),k=b&&i.has(e)?b.classList.contains("text-success"):!1;if(D.isOpen(e)&&(!D.getResultId(e)&&k===d||confirm("Are you sure?"))&&D.remove(e).then(()=>E(e)),!D.isOpen(e)){let t=document.getElementById(`form-inner-${e}`);(t.value.length===0||w.base64Encode(t.value)===t.getAttribute("data-original")&&k===d||confirm("Are you sure?"))&&E(e)}},show:c,showMore:(e,n)=>{let d=document.getElementById(`content-${n}`),b=w.base64Decode(d.getAttribute("data-comment")),k=e.getAttribute("data-show")==="false";d.innerHTML=k?b:b.slice(0,V.maxCommentLength)+"...",e.innerText=k?"Sebagian":"Selengkapnya",e.setAttribute("data-show",k?"true":"false")},showOrHide:a}})();var me=(()=>{let i=null,l=()=>{let a=document.getElementById("count-down")?.getAttribute("data-time")?.replace(" ","T");if(!a){alert("Invalid countdown date.");return}let p=new Date(a).getTime(),v=()=>{let T=Math.abs(p-Date.now());document.getElementById("day").innerText=Math.floor(T/(1e3*60*60*24)).toString(),document.getElementById("hour").innerText=Math.floor(T%(1e3*60*60*24)/(1e3*60*60)).toString(),document.getElementById("minute").innerText=Math.floor(T%(1e3*60*60)/(1e3*60)).toString(),document.getElementById("second").innerText=Math.floor(T%(1e3*60)/1e3).toString(),w.timeOut(v,1e3-Date.now()%1e3)};requestAnimationFrame(v)},h=()=>{let a=window.location.search.split("to="),p=null;if(a.length>1&&a[1].length>=1&&(p=window.decodeURIComponent(a[1])),p){let T=document.getElementById("guest-name"),y=document.createElement("div");y.classList.add("m-2"),y.innerHTML=`<small class="mt-0 mb-1 mx-0 p-0">${T?.getAttribute("data-message")}</small><p class="m-0 p-0" style="font-size: 1.5rem">${w.escapeHtml(p)}</p>`,T?.appendChild(y)}let v=document.getElementById("form-name");v&&(v.value=i.get("name")??p)},r=async()=>{let a=0,p=0,v=6e3,T=document.querySelectorAll(".slide-desktop");for(let[I,B]of T.entries())if(I===a){B.classList.add("slide-desktop-active"),await w.changeOpacity(B,!0);break}let y=async()=>{await w.changeOpacity(T[a],!1),T[a].classList.remove("slide-desktop-active"),a=(a+1)%T.length,T[a].classList.add("slide-desktop-active"),await w.changeOpacity(T[a],!0)},S=async I=>{I-p>=v&&(p=I,await y()),requestAnimationFrame(S)};w.timeOut(S,v)},g=a=>{a.disabled=!0,document.body.scrollIntoView({behavior:"instant"}),document.dispatchEvent(new Event("undangan.open")),Y.isAutoMode()&&(document.getElementById("button-theme").style.display="block"),r(),Z.play(),Y.spyTop(),le(),w.timeOut(ce,1500),w.changeOpacity(document.getElementById("welcome"),!1).then(p=>p.remove())},s=a=>{let p=document.getElementById("show-modal-image");p.src=a.src,p.width=a.width,p.height=a.height,ae.modal("modal-image").show()},f=()=>i.set("info",!0),u=()=>{document.querySelectorAll(".font-arabic").forEach(a=>{a.innerHTML=String(a.innerHTML).normalize("NFC")})},E=()=>{document.querySelectorAll("svg").forEach(a=>{w.timeOut(()=>a.classList.add(a.getAttribute("data-class")),parseInt(a.getAttribute("data-time")))})},$=()=>{let a=T=>new Date(T+":00Z").toISOString().replace(/[-:]/g,"").split(".")[0],p=new URL("https://calendar.google.com/calendar/render"),v={action:"TEMPLATE",text:"The Wedding of Ijal and Hani",dates:`${a("2023-03-15 10:00")}/${a("2023-03-15 11:00")}`,details:"Tanpa mengurangi rasa hormat, kami mengundang Anda untuk berkenan menghadiri acara pernikahan kami. Terima kasih atas perhatian dan doa restu Anda, yang menjadi kebahagiaan serta kehormatan besar bagi kami.",location:"https://www.google.com/maps?q=-6.6882401,106.8118001&z=17&hl=id",ctz:"Asia/Bogor"};Object.entries(v).forEach(([T,y])=>p.searchParams.set(T,y)),document.querySelector("#home button")?.addEventListener("click",()=>window.open(p,"_blank"))},A=async()=>{E(),l(),h(),u(),$(),document.getElementById("root").style.opacity="1",i.has("presence")&&(document.getElementById("form-presence").value=i.get("presence")?"1":"2"),i.get("info")&&document.getElementById("information")?.remove(),window.AOS.init(),document.body.scrollIntoView({behavior:"instant"}),await w.changeOpacity(document.getElementById("welcome"),!0),await w.changeOpacity(document.getElementById("loading"),!1).then(a=>a.remove())},o=()=>{ie.init(),_.init(),i=C("information");let a=document.body.getAttribute("data-key");if(document.addEventListener("progress.done",()=>A()),document.addEventListener("hide.bs.modal",()=>document.activeElement?.blur()),(!a||a.length<=0)&&(_.add(),te.init().load(),Z.init(),document.getElementById("comment")?.remove(),document.querySelector('a.nav-link[href="#comment"]')?.closest("li.nav-item")?.remove()),a&&a.length>0){_.add(),_.add(),_.add();let p=te.init();p.hasDataSrc()||p.load();let v=new URLSearchParams(window.location.search);q.setToken(v.get("k")??a),window.addEventListener("load",()=>q.guest().then(()=>{_.complete("config"),p.hasDataSrc()&&p.load(),Z.init(),ee.init(),ee.show().then(()=>_.complete("comment")).catch(()=>_.invalid("comment"))}).catch(()=>_.invalid("config")))}};return{init:()=>(Y.init(),q.init(),q.isAdmin()&&(C("user").clear(),C("owns").clear(),C("likes").clear(),C("session").clear(),C("comment").clear(),C("tracker").clear()),window.addEventListener("DOMContentLoaded",o),{util:w,theme:Y,comment:ee,guest:{open:g,modal:s,closeInformation:f}})}})();(i=>{i.undangan=me.init()})(window);})();
