(()=>{var y=(()=>{let d='<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>',h=a=>String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),b=(a,u,w=.05)=>new Promise(E=>{let R=parseFloat(a.style.opacity),r=u?1:0,p=()=>{R+=u?w:-w,R=Math.max(0,Math.min(1,R)),a.style.opacity=R.toFixed(2),u&&R>=r||!u&&R<=r?(a.style.opacity=r.toString(),E(a)):requestAnimationFrame(p)};requestAnimationFrame(p)}),o=(a,u)=>{let w=null;w=setTimeout(()=>{a(),clearTimeout(w),w=null},u)};return{loader:d,copy:async(a,u=null,w=1500)=>{let E=a.getAttribute("data-copy");if(!E||E.length===0){alert("Nothing to copy");return}a.disabled=!0;try{await navigator.clipboard.writeText(E)}catch{a.disabled=!1,alert("Failed to copy");return}let R=a.innerHTML;a.innerHTML=u||'<i class="fa-solid fa-check"></i>',o(()=>{a.disabled=!1,a.innerHTML=R},w)},timeOut:o,debounce:(a,u)=>{let w=null;return(...E)=>{clearTimeout(w),w=setTimeout(()=>a(...E),u)}},escapeHtml:h,base64Encode:a=>{let w=new TextEncoder().encode(a);return window.btoa(String.fromCharCode(...w))},base64Decode:a=>{let u=new TextDecoder,w=Uint8Array.from(window.atob(a),E=>E.charCodeAt(0));return u.decode(w)},disableButton:(a,u="Loading",w=!1)=>{a.disabled=!0;let E=a.innerHTML;return a.innerHTML=w?u:d+u,{restore:(R=!1)=>{a.innerHTML=E,a.disabled=R}}},disableCheckbox:a=>{a.disabled=!0;let u=document.querySelector(`label[for="${a.id}"]`),w=u.innerHTML;return u.innerHTML=d+w,{restore:()=>{u.innerHTML=w,a.disabled=!1}}},parseUserAgent:a=>{let u=[{type:"Mobile",regex:/Android.*Mobile|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)|Tablet/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],w=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i}],E=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i}],R=u.find(D=>D.regex.test(a))?.type||"Unknown",r=w.find(D=>D.regex.test(a))?.name||"Unknown",p=E.find(D=>D.regex.test(a)),L=p&&a.match(p.regex)?.[1]?.replace(/_/g,".")||"",U=p?p.name:"Unknown";return L=L?`${U} ${L}`:U,`${r} ${R} ${L}`},changeOpacity:b}})();var Q={tab:b=>window.bootstrap.Tab.getOrCreateInstance(document.getElementById(b)),modal:b=>window.bootstrap.Modal.getOrCreateInstance(document.getElementById(b))};var O=(()=>{let d=(u,w,E)=>({code:u,data:w,error:E}),h=(u=0)=>({love:u}),b=({uuid:u,own:w,name:E,presence:R,comment:r,created_at:p,is_admin:L,gif_url:U,ip:D,user_agent:J,comments:t,like:n})=>({uuid:u,own:w,name:E,presence:R,comment:r,created_at:p,is_admin:L??!1,gif_url:U,ip:D,user_agent:J,comments:t?.map(b)??[],like:h(n?.love??0)});return{uuidResponse:({uuid:u})=>({uuid:u}),baseResponse:d,tokenResponse:({token:u})=>({token:u}),statusResponse:({status:u})=>({status:u}),commentResponse:({name:u,presence:w,comment:E,is_admin:R,gif_url:r,created_at:p})=>({name:u,presence:w,comment:E,is_admin:R,gif_url:r,created_at:p}),likeCommentResponse:h,getCommentResponse:b,getCommentsResponse:u=>u.map(b),commentShowMore:(u,w=!1)=>({uuid:u,show:w}),postCommentRequest:(u,w,E,R,r)=>({id:u,name:w,presence:E,comment:R,gif_id:r}),postSessionRequest:(u,w)=>({email:u,password:w}),updateCommentRequest:(u,w,E)=>({presence:u,comment:w,gif_id:E})}})();var S=d=>{let h=(c=null)=>{let m=JSON.parse(localStorage.getItem(d));return c?m[String(c)]:m},b=(c,m)=>{let k=h();k[String(c)]=m,localStorage.setItem(d,JSON.stringify(k))},o=c=>Object.keys(h()).includes(String(c)),f=c=>{if(!o(c))return;let m=h();delete m[String(c)],localStorage.setItem(d,JSON.stringify(m))},s=()=>localStorage.setItem(d,"{}");return localStorage.getItem(d)||s(),{set:b,get:h,has:o,clear:s,unset:f}};var j="GET",Z="PUT",W="POST",V="PATCH",se="DELETE",K=200,ee=201,de=500,C=(d,h)=>{let b=new AbortController,o=document.body.getAttribute("data-url"),f={signal:b.signal,method:String(d).toUpperCase(),headers:new Headers({Accept:"application/json","Content-Type":"application/json"})};return window.addEventListener("offline",()=>b.abort()),window.addEventListener("popstate",()=>b.abort()),window.addEventListener("beforeunload",()=>b.abort()),o&&o.slice(-1)==="/"&&(o=o.slice(0,-1)),{send(s=null){return fetch(o+h,f).then(c=>c.json().then(m=>{if(c.status>=de&&(m.message??m[0]))throw new Error(m.message??m[0]);if(m.error)throw new Error(m.error[0]);return s&&(m.data=s(m.data)),O.baseResponse(m.code,m.data,m.error)})).catch(c=>{if(c.name==="AbortError")return console.warn("Fetch abort:",c),c;throw alert(c),new Error(c)})},download(){return fetch(o+h,f).then(s=>{if(s.status!==K)return!1;let c=document.querySelector("a[download]");c&&document.body.removeChild(c);let m=s.headers.get("content-disposition")?.match(/filename="(.+)"/)?.[1]??"download.csv";return s.blob().then(k=>{let T=document.createElement("a"),B=window.URL.createObjectURL(k);return T.href=B,T.download=m,document.body.appendChild(T),T.click(),document.body.removeChild(T),window.URL.revokeObjectURL(B),!0})}).catch(s=>{if(s.name==="AbortError")return console.warn("Fetch abort:",s),s;throw alert(s),new Error(s)})},withCancel(s){return(async()=>(await s,b.abort()))(),this},default(s=null){return f.headers=new Headers(s??{}),fetch(h,f)},token(s){return s.split(".").length===3?(f.headers.append("Authorization","Bearer "+s),this):(f.headers.append("x-access-key",s),this)},body(s){return f.body=JSON.stringify(s),this}}};var A=(()=>{let d=null,h=()=>d.get("token"),b=T=>d.set("token",T),o=T=>C(W,"/api/session").body(T).send(O.tokenResponse).then(B=>(B.code===K&&b(B.data.token),B.code===K),()=>!1),f=()=>d.unset("token"),s=()=>String(h()??".").split(".").length===3;return{init:()=>{d=S("session")},guest:()=>C(j,"/api/config").token(h()).send().then(T=>{if(T.code!==K)throw new Error("failed to get config.");let B=S("config");for(let[a,u]of Object.entries(T.data))B.set(a,u);return T}),login:o,logout:f,decode:()=>{if(!s())return null;try{return JSON.parse(window.atob(h().split(".")[1]))}catch{return null}},isAdmin:s,setToken:b,getToken:h}})();var X=(()=>{let d=null,h=async c=>{let m=y.disableButton(c),k=document.getElementById("loginEmail"),T=document.getElementById("loginPassword");k.disabled=!0,T.disabled=!0,await A.login(O.postSessionRequest(k.value,T.value))&&(k.value=null,T.value=null,Q.modal("mainModal").hide()),m.restore(),k.disabled=!1,T.disabled=!1},b=()=>{d.clear(),A.logout(),Q.modal("mainModal").show()};return{init:()=>{d=S("user")},login:h,clearSession:b,getDetailUser:()=>C(j,"/api/user").token(A.getToken()).send().then(c=>{if(c.code!==K)throw new Error("failed to get user.");return Object.entries(c.data).forEach(([m,k])=>d.set(m,k)),c},c=>(b(),c)),getUserStorage:()=>d}})();var oe=(()=>{let d=(o,f)=>{document.querySelectorAll(".navbar button").forEach(s=>{s.classList.contains("active")&&s.classList.remove("active")}),Q.tab(f).show(),o.classList.add("active")};return{buttonNavHome:o=>{d(o,"button-home")},buttonNavSetting:o=>{d(o,"button-setting")}}})();var te=(()=>{let d={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},h=["#ffffff","#f8f9fa"],b=["#000000","#212529"],o=!1,f=null,s=null,c=()=>f.set("active","light"),m=()=>f.set("active","dark"),k=r=>{let p=s.getAttribute("content");s.setAttribute("content",r.some(L=>L===p)?d[p]:p)},T=()=>{c(),document.documentElement.setAttribute("data-bs-theme","light"),k(b)},B=()=>{m(),document.documentElement.setAttribute("data-bs-theme","dark"),k(h)},a=(r=null,p=null)=>{let L=f.get("active")==="dark";return r&&p?L?r:p:L};return{init:()=>{switch(f=S("theme"),s=document.querySelector('meta[name="theme-color"]'),f.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?m():c()),document.documentElement.getAttribute("data-bs-theme")){case"dark":m();break;case"light":c();break;default:o=!0}a()?B():T()},spyTop:()=>{let r=L=>L.filter(U=>U.isIntersecting).forEach(U=>{let D=U.target.classList.contains("bg-white-black")?a(b[0],h[0]):a(b[1],h[1]);s.setAttribute("content",D)}),p=new IntersectionObserver(r,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(L=>p.observe(L))},change:()=>a()?T():B(),isDarkMode:a,isAutoMode:()=>o}})();var ae=(()=>{let d=null,h=!0,b=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"],o=()=>h,f=()=>{let a=d.firstElementChild.firstElementChild;a.classList.remove("bg-success"),a.classList.add("bg-danger"),a.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},s=()=>{let a=d.firstElementChild.firstElementChild;a.classList.remove("bg-danger"),a.classList.add("bg-success"),a.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},c=async()=>{h&&(await y.changeOpacity(d,!1),f())},m=()=>{document.querySelectorAll(b.join(", ")).forEach(a=>{a.dispatchEvent(new Event(o()?"online":"offline")),a.setAttribute("data-offline-disabled",o()?"false":"true"),a.tagName==="BUTTON"?o()?a.classList.remove("disabled"):a.classList.add("disabled"):o()?a.removeAttribute("disabled"):a.setAttribute("disabled","true")})},k=()=>{h=!1,f(),y.changeOpacity(d,!0),m()},T=()=>{h=!0,s(),y.timeOut(c,3e3),m()};return{init:()=>{window.addEventListener("online",T),window.addEventListener("offline",k),d=document.getElementById("offline-mode"),d.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`},isOnline:o}})();var q=(()=>{let d="gifs",h="default",b={128:2,256:3,512:4,768:5},o={id:"ID",en:"US",fr:"FR",de:"DE",es:"ES",zh:"CN",ja:"JP",ko:"KR",ar:"SA",ru:"RU",it:"IT",nl:"NL",pt:"PT",tr:"TR",th:"TH",vi:"VN",ms:"MY",hi:"IN"},f=null,s=null,c=null,m=null,k=async e=>{if(f.has(e))return f.get(e);let i=(x,P=3,M=1e3)=>C(j,e).default().then(_=>_.blob().then(H=>x.put(e,new Response(H,{headers:new Headers(_.headers)})).then(()=>H))).catch(_=>{if(P<=0)throw _;return console.warn("Retrying fetch:"+e),new Promise(H=>y.timeOut(()=>H(i(x,P-1,M+1e3)),M))}),$=x=>x.match(e).then(P=>{if(!P)return i(x);let M=P.headers.get("expires"),_=M?new Date(M).getTime():0;return Date.now()>_?x.delete(e).then(H=>H?i(x):P.blob()):P.blob()});return await caches.open(d).then(x=>$(x)).then(x=>URL.createObjectURL(x)).then(x=>(f.set(e,x),x))},T=async(e,i)=>{let{id:$,media_formats:{tinygif:{url:I}},content_description:x}=i;e.pointer===-1||e.pointer===e.col-1?e.pointer=0:e.pointer++;let P=0;for(let M of e.lists.childNodes){if(P===e.pointer){await k(I).then(_=>{M.insertAdjacentHTML("beforeend",`
                    <figure class="gif-figure m-0 position-relative">
                        <div onclick="undangan.comment.gif.click('${e.uuid}', '${$}', '${y.base64Encode(I)}')" class="gif-checklist position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-1 m-1 rounded-circle border shadow-sm z-1">
                            <i class="fa-solid fa-circle-check"></i>
                        </div>
                        <img src="${_}" class="img-fluid" alt="${y.escapeHtml(x)}" style="width: 100%;">
                    </figure>`)});break}P++}},B=e=>{let i=e.lists,$=document.getElementById(`gif-loading-${e.uuid}`),I=document.getElementById(`progress-bar-${e.uuid}`),x=document.getElementById(`progress-info-${e.uuid}`),P=0,M=0;return x.innerText=`${M}/${P}`,i.classList.contains("d-none")||$.classList.replace("d-none","d-flex"),i.setAttribute("data-continue","false"),i.classList.replace("overflow-y-scroll","overflow-y-hidden"),{release:()=>{x.innerText=`${M}/${P}`,I.style.width="0%",i.classList.contains("d-none")||$.classList.replace("d-flex","d-none"),i.setAttribute("data-continue","true"),i.classList.replace("overflow-y-hidden","overflow-y-scroll")},until:z=>{P=z,x.innerText=`${M}/${P}`},step:()=>{M+=1,x.innerText=`${M}/${P}`,I.style.width=Math.min(M/P*100,100).toString()+"%"}}},a=(e,i,$)=>{$={media_filter:"tinygif",client_key:"undangan_app",key:m.get("tenor_key"),country:m.get("country"),locale:m.get("locale"),...$??{}};let I=Object.keys($).filter(M=>$[M]!==null&&$[M]!==void 0).map(M=>`${M}=${encodeURIComponent($[M])}`).join("&"),x=`https://tenor.googleapis.com/v2${i}?${I}`,P=new Promise(M=>{e.reqs.push(M)});e.last=new Promise(M=>{let _=!0;(async()=>(await P,_=!1))(),(async()=>{let H=B(e);try{let N=await C(j,x).withCancel(P).default().then(z=>z.json()).then(z=>{if(!z.error)return z;throw new Error(z.error.message)});e.next=N?.next,H.until(N.results.length);for(let z of N.results)try{_&&(e.gifs.push(z),await T(e,z),H.step())}catch(le){throw _=!1,le}}catch(N){_=!1,N.name==="AbortError"?console.warn("Fetch abort:",N):alert(N)}finally{H.release(),M()}})()})},u=e=>`
        <label for="gif-search-${e}" class="form-label my-1"><i class="fa-solid fa-photo-film me-2"></i>Gif</label>

        <div class="d-flex mb-3" id="gif-search-nav-${e}">
            <button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1" onclick="undangan.comment.gif.back(this, '${e}')" data-offline-disabled="false"><i class="fa-solid fa-arrow-left"></i></button>
            <input type="text" name="gif-search" id="gif-search-${e}" autocomplete="on" class="form-control shadow-sm rounded-4" placeholder="Cari GIF oleh Tenor" data-offline-disabled="false">
        </div>

        <div class="position-relative">
            <div class="position-absolute d-flex flex-column justify-content-center align-items-center top-50 start-50 translate-middle w-100 h-100 bg-overlay-auto rounded-4 z-3" id="gif-loading-${e}">
                <div class="progress w-25" role="progressbar" style="height: 0.5rem;" aria-label="progress bar">
                    <div class="progress-bar" id="progress-bar-${e}" style="width: 0%"></div>
                </div>
                <small class="mt-1 text-theme-auto bg-theme-auto py-0 px-2 rounded-4" id="progress-info-${e}" style="font-size: 0.7rem;"></small>
            </div>
            <div id="gif-lists-${e}" class="d-flex rounded-4 p-0 overflow-y-scroll border" data-continue="true" style="height: 15rem;"></div>
        </div>

        <figure class="d-flex m-0 position-relative" id="gif-result-${e}">
            <div onclick="undangan.comment.gif.cancel('${e}')" id="gif-cancel-${e}" class="d-none position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-2 m-1 rounded-circle border shadow-sm z-1" style="cursor: pointer;">
                <i class="fa-solid fa-circle-xmark"></i>
            </div>
        </figure>`,w=async e=>{let i=0;for(let[I,x]of Object.entries(b))i=x,e.lists.clientWidth>=parseInt(I)&&(e.col=i);if(e.col===null&&(e.col=i),e.pointer=-1,e.limit=e.col*5,e.lists.innerHTML='<div class="d-flex flex-column"></div>'.repeat(e.col),e.gifs.length===0)return;let $=B(e);$.until(e.gifs.length);for(let I of e.gifs)try{await T(e,I),$.step()}catch{e.gifs=[];break}$.release(),e.gifs.length===0&&await w(e)},E=async e=>{e.reqs.forEach(i=>i()),e.reqs=[],e.last&&(await e.last,e.last=null)},R=async e=>{if(e.lists.getAttribute("data-continue")!=="true"||!e.next||e.next.length===0)return;let i=e.query&&e.query.trim().length>0,$={pos:e.next,limit:e.limit};i&&($.q=e.query),e.lists.scrollTop>(e.lists.scrollHeight-e.lists.clientHeight)*.9&&(await E(e),a(e,i?"/search":"/featured",$))},r=async(e,i)=>{await E(e),e.query=i.value,(!e.query||e.query.trim().length===0)&&(e.query=null),e.next=null,e.gifs=[],e.pointer=-1,await w(e),a(e,e.query===null?"/featured":"/search",{q:e.query,limit:e.limit})},p=e=>{if(!s.has(e)){document.getElementById(`gif-form-${e}`).innerHTML=u(e),s.set(e,{uuid:e,last:null,limit:null,query:null,next:null,col:null,pointer:-1,gifs:[],reqs:[],lists:document.getElementById(`gif-lists-${e}`)});let i=s.get(e),$=y.debounce(w,750),I=y.debounce(r,750);window.addEventListener("resize",()=>$(i)),i.lists.addEventListener("scroll",()=>R(i)),document.getElementById(`gif-search-${e}`).addEventListener("input",x=>I(i,x.target))}return s.get(e)};return{default:h,init:()=>{f=new Map,c=new Map,s=new Map,m=S("config");let e=document.documentElement.lang.toLowerCase();m.set("country",o[e]??"US"),m.set("locale",`${e}_${m.get("country")}`),m.get("tenor_key")===null&&document.querySelector('[onclick="undangan.comment.gif.open(undangan.comment.gif.default)"]')?.remove()},cache:k,back:async(e,i)=>{let $=y.disableButton(e,y.loader.replace("me-1","me-0"),!0);await E(s.get(i)),$.restore(),document.getElementById(`gif-form-${i}`).classList.toggle("d-none",!0),document.getElementById(`comment-form-${i}`)?.classList.toggle("d-none",!1)},open:async e=>{let i=p(e);document.getElementById(`gif-form-${e}`).classList.toggle("d-none",!1),document.getElementById(`comment-form-${e}`)?.classList.toggle("d-none",!0),c.has(e)&&c.get(e)(),await E(i),await w(i),a(i,"/featured",{limit:i.limit})},cancel:e=>{let i=document.getElementById(`gif-result-${e}`);i.removeAttribute("data-id"),i.querySelector(`#gif-cancel-${e}`).classList.replace("d-flex","d-none"),i.querySelector("img").remove(),s.get(e).lists.classList.replace("d-none","d-flex"),document.getElementById(`gif-search-nav-${e}`).classList.replace("d-none","d-flex")},click:(e,i,$)=>{let I=document.getElementById(`gif-result-${e}`);I.setAttribute("data-id",i),I.querySelector(`#gif-cancel-${e}`).classList.replace("d-none","d-flex"),I.insertAdjacentHTML("beforeend",`<img src="${f.get(y.base64Decode($))}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">`),s.get(e).lists.classList.replace("d-flex","d-none"),document.getElementById(`gif-search-nav-${e}`).classList.replace("d-flex","d-none")},remove:async(e=null)=>{e?s.has(e)&&(await E(s.get(e)),s.delete(e),c.delete(e)):(await Promise.all(Array.from(s.keys()).map(i=>E(s.get(i)))),s.clear(),c.clear())},isOpen:e=>{let i=document.getElementById(`gif-form-${e}`);return i===null?!1:!i.classList.contains("d-none")},onOpen:(e,i)=>c.set(e,i),getResultId:e=>document.getElementById(`gif-result-${e}`)?.getAttribute("data-id")}})();var F=(()=>{let d=null,h=null,b=null,o=null,f=null,s=null,c=300,m=[["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']],k=()=>`
        <div class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4">
            <div class="d-flex justify-content-between align-items-center placeholder-wave">
                <span class="placeholder bg-secondary col-5 rounded-3 my-1"></span>
                <span class="placeholder bg-secondary col-3 rounded-3 my-1"></span>
            </div>
            <hr class="my-1">
            <p class="placeholder-wave m-0">
                <span class="placeholder bg-secondary col-6 rounded-3"></span>
                <span class="placeholder bg-secondary col-5 rounded-3"></span>
                <span class="placeholder bg-secondary col-12 rounded-3 my-1"></span>
            </p>
        </div>`,T=t=>(m.forEach(n=>{let l=n[0],g=n[1];t=t.replace(new RegExp(`\\${l}(?=\\S)(.*?)(?<!\\s)\\${l}`,"gs"),g)}),t),B=t=>`
        <button style="font-size: 0.8rem;" onclick="undangan.comment.like.love(this)" data-uuid="${t.uuid}" class="btn btn-sm btn-outline-auto ms-auto rounded-3 p-0 shadow-sm d-flex justify-content-start align-items-center" data-offline-disabled="false">
            <span class="my-0 mx-1" data-count-like="${t.like.love}">${t.like.love}</span>
            <i class="me-1 ${b.has(t.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
        </button>`,a=t=>{let n=t.gif_url!==null&&t.gif_url!==void 0,l=`<div class="d-flex justify-content-start align-items-center" data-button-action="${t.uuid}">`;return(o.get("can_reply")===!0||o.get("can_reply")===void 0)&&(l+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.reply(this)" data-uuid="${t.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Reply</button>`),h.has(t.uuid)&&(o.get("can_edit")===!0||o.get("can_edit")===void 0)&&!(n&&o.get("tenor_key")===null)&&(l+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this)" data-uuid="${t.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Edit</button>`),A.isAdmin()?l+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${t.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${t.own}" data-offline-disabled="false">Delete</button>`:h.has(t.uuid)&&(o.get("can_delete")===!0||o.get("can_delete")===void 0)&&(l+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${t.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Delete</button>`),l+="</div>",l},u=(t,n)=>{let l=s.get("show").includes(t);return`<a class="text-theme-auto" style="font-size: 0.8rem;" onclick="undangan.comment.showOrHide(this)" data-uuid="${t}" data-uuids="${n.join(",")}" data-show="${l?"true":"false"}" role="button" class="me-auto ms-1 py-0">${l?"Hide replies":`Show replies (${n.length})`}</a>`},w=t=>`
        <div class="d-flex justify-content-between align-items-center" id="button-${t.uuid}">
            ${a(t)}
            ${t.comments.length>0?u(t.uuid,t.comments.map(n=>n.uuid)):""}
            ${B(t)}
        </div>`,E=t=>t.ip===void 0||t.user_agent===void 0||t.is_admin?"":`
        <div class="mb-1 mt-3">
            <p class="text-theme-auto mb-1 mx-0 mt-0 p-0" style="font-size: 0.7rem;" id="ip-${t.uuid}"><i class="fa-solid fa-location-dot me-1"></i>${y.escapeHtml(t.ip)} ${f.has(t.ip)?`<strong>${f.get(t.ip)}</strong>`:'<span class="mb-1 placeholder col-2 rounded-3"></span>'}</p>
            <p class="text-theme-auto m-0 p-0" style="font-size: 0.7rem;"><i class="fa-solid fa-mobile-screen-button me-1"></i>${y.parseUserAgent(y.escapeHtml(t.user_agent))}</p>
        </div>`,R=(t,n)=>n?'class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4" data-parent="true"':`class="${s.get("hidden").find(l=>l.uuid===t.uuid).show?"":"d-none"} overflow-x-scroll mw-100 border-start bg-theme-auto py-2 ps-2 pe-0 my-2 ms-2 me-0"`,r=(t,n)=>t.is_admin?`<strong class="me-1">${y.escapeHtml(d.get("name")??o.get("name"))}</strong><i class="fa-solid fa-certificate text-primary"></i>`:n?`<strong class="me-1">${y.escapeHtml(t.name)}</strong><i id="badge-${t.uuid}" class="fa-solid ${t.presence?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>`:`<strong>${y.escapeHtml(t.name)}</strong>`,p=async(t,n)=>{let l=`
        <div class="d-flex justify-content-between align-items-center">
            <p class="text-theme-auto text-truncate m-0 p-0" style="font-size: 0.95rem;">${r(t,n)}</p>
            <small class="text-theme-auto m-0 p-0" style="font-size: 0.75rem;">${t.created_at}</small>
        </div>
        <hr class="my-1">`;if(t.gif_url!==null&&t.gif_url!==void 0)return l+`
            <div class="d-flex justify-content-center align-items-center my-2">
                <img src="${await q.cache(t.gif_url)}" id="img-gif-${t.uuid}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">
            </div>`;let g=T(y.escapeHtml(t.comment)),v=g.length>c;return l+`
        <p class="text-theme-auto my-1 mx-0 p-0" style="white-space: pre-wrap !important; font-size: 0.95rem;" ${v?`data-comment="${y.base64Encode(g)}"`:""} id="content-${t.uuid}">${v?g.slice(0,c)+"...":g}</p>
        ${v?`<p class="d-block mb-2 mt-0 mx-0 p-0"><a class="text-theme-auto" role="button" style="font-size: 0.85rem; display: block;" data-show="false" onclick="undangan.comment.showMore(this, '${t.uuid}')">Selengkapnya</a></p>`:""}`},L=async(t,n)=>{let l=await p(t,n),g="";for(let v of t.comments)g+=await L(v,!1);return`
        <div ${R(t,n)} id="${t.uuid}" style="overflow-wrap: break-word !important;">
            <div id="body-content-${t.uuid}" data-tapTime="0" data-liked="false" tabindex="0">${l}</div>
            ${E(t)}
            ${w(t)}
            <div id="reply-content-${t.uuid}">${g}</div>
        </div>`};return{init:()=>{d=S("user"),h=S("owns"),b=S("likes"),o=S("config"),f=S("tracker"),s=S("comment")},renderEdit:(t,n,l,g)=>{let v=document.createElement("div");return v.classList.add("my-2"),v.id=`inner-${t}`,v.innerHTML=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-pen me-2"></i>Edit</p>
        ${l?`
        <select class="form-select shadow-sm mb-2 rounded-4" id="form-inner-presence-${t}" data-offline-disabled="false">
            <option value="1" ${n?"selected":""}>Datang</option>
            <option value="2" ${n?"":"selected"}>Berhalangan</option>
        </select>`:""}
        ${g?`${o.get("tenor_key")===null?"":`<div class="d-none mb-2" id="gif-form-${t}"></div>`}`:`<textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${t}" minlength="1" maxlength="1000" placeholder="Type update comment" rows="3" data-offline-disabled="false"></textarea>    
        `}
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel('${t}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.update(this)" data-uuid="${t}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Update</button>
        </div>`,v},renderReply:t=>{let n=document.createElement("div");return n.classList.add("my-2"),n.id=`inner-${t}`,n.innerHTML=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-reply me-2"></i>Reply</p>
        <div class="d-block mb-2" id="comment-form-${t}">
            <div class="position-relative">
                ${o.get("tenor_key")===null?"":`<button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1 position-absolute bottom-0 end-0" onclick="undangan.comment.gif.open('${t}')" aria-label="button gif" data-offline-disabled="false"><i class="fa-solid fa-photo-film"></i></button>`}
                <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${t}" minlength="1" maxlength="1000" placeholder="Type reply comment" rows="3" data-offline-disabled="false"></textarea>
            </div>
        </div>
        <div class="d-none mb-2" id="gif-form-${t}"></div>
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel('${t}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.send(this)" data-uuid="${t}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Send</button>
        </div>`,n},renderLoading:k,renderReadMore:u,renderInnerContent:t=>L(t,!1),renderContent:t=>L(t,!0),convertMarkdownToHTML:T,maxCommentLength:c}})();var ce=()=>window.confetti.shapeFromPath({path:"M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z",matrix:[.03333333333333333,0,0,.03333333333333333,-5.566666666666666,-5.533333333333333]});var ie=d=>{if(!window.confetti)return;let h=Date.now()+25,b=Math.max(.3,Math.min(1,d.getBoundingClientRect().top/window.innerHeight+.2)),o=ce(),f=["#FF69B4","#FF1493"],s=()=>{f.forEach(c=>{window.confetti({particleCount:2,angle:60,spread:55,shapes:[o],origin:{x:0,y:b},zIndex:1057,colors:[c]}),window.confetti({particleCount:2,angle:120,spread:55,shapes:[o],origin:{x:1,y:b},zIndex:1057,colors:[c]})}),Date.now()<h&&requestAnimationFrame(s)};requestAnimationFrame(s)};var Y=(()=>{let d=null,h=async s=>{let c=s.firstElementChild,m=s.lastElementChild,k=s.getAttribute("data-uuid"),T=parseInt(c.getAttribute("data-count-like"));s.disabled=!0,navigator.vibrate&&navigator.vibrate(100),d.has(k)?await C(V,"/api/comment/"+d.get(k)).token(A.getToken()).send(O.statusResponse).then(B=>{B.data.status&&(d.unset(k),m.classList.remove("fa-solid","text-danger"),m.classList.add("fa-regular"),c.setAttribute("data-count-like",String(T-1)))}):await C(W,"/api/comment/"+k).token(A.getToken()).send(O.uuidResponse).then(B=>{B.code===ee&&(d.set(k,B.data.uuid),m.classList.remove("fa-regular"),m.classList.add("fa-solid","text-danger"),c.setAttribute("data-count-like",String(T+1)))}),c.innerText=c.getAttribute("data-count-like"),s.disabled=!1},b=s=>document.querySelector(`button[onclick="undangan.comment.like.love(this)"][data-uuid="${s}"]`);return{init:()=>{d=S("likes")},love:h,tapTap:async s=>{if(!navigator.onLine)return;let c=Date.now(),m=c-parseInt(s.getAttribute("data-tapTime")),k=s.id.replace("body-content-",""),T=m<300&&m>0,B=!d.has(k)&&s.getAttribute("data-liked")!=="true";T&&B&&(ie(s),s.setAttribute("data-liked","true"),await h(b(k)),s.setAttribute("data-liked","false")),s.setAttribute("data-tapTime",c)},getButtonLike:b}})();var G=(()=>{let d=10,h=0,b=0,o=null,f=null,s=null,c=null,m=null,k=n=>{d=Number(n)},T=()=>d,B=()=>h,a=()=>b,u=()=>f.classList.contains("disabled")?null:f.classList.add("disabled"),w=()=>f.classList.contains("disabled")?f.classList.remove("disabled"):null,E=()=>s.classList.contains("disabled")?null:s.classList.add("disabled"),R=()=>s.classList.contains("disabled")?s.classList.remove("disabled"):null,r=()=>{c.classList.contains("d-none")&&c.classList.remove("d-none")},p=n=>{n.disabled=!0;let l=n.innerHTML;n.innerHTML=y.loader.replace("ms-0 me-1","mx-1");let g=async()=>{let i=new Promise($=>m.addEventListener("comment.result",$,{once:!0}));m.dispatchEvent(new Event("comment.show")),await i,n.disabled=!1,n.innerHTML=l,m.scrollIntoView({behavior:"smooth"})};return{next:async()=>{h+=d,n.innerHTML="Next"+n.innerHTML,await g(),o.innerText=String(parseInt(o.innerText)+1)},prev:async()=>{h-=d,n.innerHTML=n.innerHTML+"Prev",await g(),o.innerText=String(parseInt(o.innerText)-1)}}};return{init:()=>{c=document.getElementById("pagination"),c.innerHTML=`
        <ul class="pagination mb-2 shadow-sm rounded-4">
            <li class="page-item disabled" id="previous">
                <button class="page-link rounded-start-4" onclick="undangan.comment.pagination.previous(this)" data-offline-disabled="false">
                    <i class="fa-solid fa-circle-left me-1"></i>Prev
                </button>
            </li>
            <li class="page-item disabled">
                <span class="page-link text-theme-auto" id="page">1</span>
            </li>
            <li class="page-item" id="next">
                <button class="page-link rounded-end-4" onclick="undangan.comment.pagination.next(this)" data-offline-disabled="false">
                    Next<i class="fa-solid fa-circle-right ms-1"></i>
                </button>
            </li>
        </ul>`,m=document.getElementById("comments"),o=document.getElementById("page"),f=document.getElementById("previous"),s=document.getElementById("next")},setPer:k,getPer:T,getNext:B,reset:()=>h===0?!1:(h=0,b=0,o.innerText=1,E(),u(),!0),setResultData:n=>{if(b=n,h>0&&w(),b<d){E();return}R(),r()},getResultData:a,previous:async n=>{u(),!(h<0)&&(E(),await p(n).prev())},next:async n=>{E(),!(b<d)&&(u(),await p(n).next())}}})();var ne=(()=>{let d=null,h=null,b=null,o=null,f=null,s=[],c=()=>'<div class="text-center p-4 my-2 bg-theme-auto rounded-4 shadow"><p class="fw-bold p-0 m-0" style="font-size: 0.95rem;">Yuk bagikan undangan ini biar banyak komentarnya</p></div>',m=(t,n)=>{document.querySelector(`[data-button-action="${t}"]`).childNodes.forEach(l=>{l.disabled=n})},k=t=>{m(t,!1),document.getElementById(`inner-${t}`).remove()},T=t=>{t.comments&&t.comments.forEach(T);let n=document.getElementById(`body-content-${t.uuid}`);n.addEventListener("touchend",()=>Y.tapTap(n))},B=t=>{if(!A.isAdmin()||(t.comments&&t.comments.forEach(B),t.ip===void 0||t.user_agent===void 0||t.is_admin||b.has(t.ip)))return;let n=(l,g,v)=>{document.getElementById(`ip-${l}`).innerHTML=`<i class="fa-solid fa-location-dot me-1"></i>${y.escapeHtml(g)} <strong>${y.escapeHtml(v)}</strong>`};C(j,`https://freeipapi.com/api/json/${t.ip}`).default().then(l=>l.json()).then(l=>{let g=l.cityName+" - "+l.regionName;l.cityName==="-"&&l.regionName==="-"&&(g="localhost"),b.set(t.ip,g),n(t.uuid,t.ip,g)}).catch(l=>n(t.uuid,t.ip,l.message))},a=(t,n=[])=>(t.forEach(l=>{n.find(g=>g.uuid===l.uuid)||n.push(O.commentShowMore(l.uuid)),l.comments&&l.comments.length>0&&a(l.comments,n)}),n),u=()=>(f.getAttribute("data-loading")==="false"&&(f.setAttribute("data-loading","true"),f.innerHTML=F.renderLoading().repeat(G.getPer())),C(j,`/api/comment?per=${G.getPer()}&next=${G.getNext()}`).token(A.getToken()).send(O.getCommentsResponse).then(async t=>{let n=t.data.length;f.setAttribute("data-loading","false");for(let g of s.map(v=>v.uuid))await q.remove(g);if(n===0)return G.setResultData(n),f.innerHTML=c(),t;s=a(t.data),o.set("hidden",a(t.data,o.get("hidden")));let l="";for(let g of t.data)l+=await F.renderContent(g);return f.innerHTML=l,t.data.forEach(B),t.data.forEach(T),G.setResultData(n),f.dispatchEvent(new Event("comment.result")),t})),w=t=>{let n=t.getAttribute("data-uuids").split(","),l=t.getAttribute("data-show")==="true",g=t.getAttribute("data-uuid");l?(t.setAttribute("data-show","false"),t.innerText=`Show replies (${n.length})`,o.set("show",o.get("show").filter(v=>v!==g))):(t.setAttribute("data-show","true"),t.innerText="Hide replies",o.set("show",o.get("show").concat([g])));for(let v of n){o.set("hidden",o.get("hidden").map(i=>(i.uuid===v&&(i.show=!l),i)));let e=document.getElementById(v).classList;l?e.add("d-none"):e.remove("d-none")}};return{gif:q,like:Y,pagination:G,init:()=>{q.init(),Y.init(),F.init(),G.init(),f=document.getElementById("comments"),f.addEventListener("comment.show",u),d=S("owns"),h=S("user"),b=S("tracker"),o=S("comment"),o.has("hidden")||o.set("hidden",[]),o.has("show")||o.set("show",[])},send:async t=>{let n=t.getAttribute("data-uuid"),l=document.getElementById("form-name"),g=l.value;if(A.isAdmin()&&(g=h.get("name")),g.length===0){alert("Name cannot be empty."),n&&document.getElementById("comment").scrollIntoView({behavior:"smooth"});return}let v=document.getElementById("form-presence");if(!n&&v&&v.value==="0"){alert("Please select your attendance status.");return}let e=q.isOpen(n||"default"),i=q.getResultId(n||"default"),$=document.getElementById(`gif-cancel-${n||"default"}`);if(e&&!i){alert("Gif cannot be empty.");return}e&&i&&$.classList.replace("d-flex","d-none");let I=document.getElementById(`form-${n?`inner-${n}`:"comment"}`);if(!e&&I.value.length===0){alert("Comments cannot be empty.");return}!n&&l&&!A.isAdmin()&&(l.disabled=!0),!A.isAdmin()&&v&&v.value!=="0"&&(v.disabled=!0),I&&(I.disabled=!0);let x=document.querySelector(`[onclick="undangan.comment.cancel('${n}')"]`);x&&(x.disabled=!0);let P=y.disableButton(t),M=v?v.value==="1":!0;if(!A.isAdmin()){let H=S("information");H.set("name",g),n||H.set("presence",M)}let _=await C(W,"/api/comment").token(A.getToken()).body(O.postCommentRequest(n,g,M,q.isOpen(n)?null:I.value,i)).send(O.getCommentResponse).then(H=>H,()=>null);if(l&&(l.disabled=!1),I&&(I.disabled=!1),x&&(x.disabled=!1),v&&(v.disabled=!1),e&&i&&$.classList.replace("d-none","d-flex"),P.restore(),!(!_||_.code!==ee)){if(d.set(_.data.uuid,_.data.own),I&&(I.value=null),e&&i&&$.dispatchEvent(new Event("click")),!n){if(G.reset()){await u(),f.scrollIntoView({behavior:"smooth"});return}G.setResultData(f.children.length),G.getResultData()===G.getPer()&&f.lastElementChild.remove(),_.data.is_admin=A.isAdmin();let H=await F.renderContent(_.data);f.insertAdjacentHTML("afterbegin",H),f.scrollIntoView({behavior:"smooth"})}if(n){o.set("hidden",o.get("hidden").concat([O.commentShowMore(_.data.uuid,!0)])),o.set("show",o.get("show").concat([n])),k(n),_.data.is_admin=A.isAdmin(),document.getElementById(`reply-content-${n}`).insertAdjacentHTML("beforeend",await F.renderInnerContent(_.data));let H=document.getElementById(`button-${n}`).querySelector("a"),N=[_.data.uuid];H&&(H.getAttribute("data-show")==="false"&&w(H),H.remove()),Y.getButtonLike(n).insertAdjacentHTML("beforebegin",F.renderReadMore(n,H?H.getAttribute("data-uuids").split(",").concat(N):N))}T(_.data)}},edit:async t=>{let n=t.getAttribute("data-uuid");if(document.getElementById(`inner-${n}`))return;m(n,!0);let l=y.disableButton(t);await C(j,"/api/comment/"+n).token(A.getToken()).send(O.commentResponse).then(async g=>{if(g.code!==K)return g;let v=g.data.gif_url!==null&&g.data.gif_url!==void 0;v&&await q.remove(n);let e=document.getElementById(n).getAttribute("data-parent")==="true"&&!A.isAdmin();if(document.getElementById(`button-${n}`).insertAdjacentElement("afterend",F.renderEdit(n,g.data.presence,e,v)),v)return q.onOpen(n,()=>{document.querySelector(`[for="gif-search-${n}"]`)?.remove(),document.querySelector(`[onclick="undangan.comment.gif.back(this, '${n}')"]`)?.remove()}),q.open(n);let i=document.getElementById(`form-inner-${n}`);return i.value=g.data.comment,i.setAttribute("data-original",y.base64Encode(g.data.comment)),g}),l.restore(!0)},reply:async t=>{let n=t.getAttribute("data-uuid");document.getElementById(`inner-${n}`)||(m(n,!0),await q.remove(n),q.onOpen(n,()=>document.querySelector(`[for="gif-search-${n}"]`)?.remove()),document.getElementById(`button-${n}`).insertAdjacentElement("afterend",F.renderReply(n)))},remove:async t=>{if(!confirm("Are you sure?"))return;let n=t.getAttribute("data-uuid");A.isAdmin()&&d.set(n,t.getAttribute("data-own")),m(n,!0);let l=y.disableButton(t),g=Y.getButtonLike(n);if(g.disabled=!0,!await C(se,"/api/comment/"+d.get(n)).token(A.getToken()).send(O.statusResponse).then(e=>e.data.status,()=>!1)){l.restore(),g.disabled=!1;return}document.querySelectorAll('a[onclick="undangan.comment.showOrHide(this)"]').forEach(e=>{let i=e.getAttribute("data-uuids").split(",");if(i.find($=>$===n)){let $=i.filter(I=>I!==n).join(",");$.length===0?e.remove():e.setAttribute("data-uuids",$)}}),d.unset(n),document.getElementById(n).remove(),f.children.length===0&&(f.innerHTML=c())},update:async t=>{let n=t.getAttribute("data-uuid"),l=!1,g=document.getElementById(`form-inner-presence-${n}`);g&&(g.disabled=!0,l=g.value==="1");let v=!1,e=document.getElementById(`badge-${n}`);e&&(v=e.classList.contains("text-success"));let i=q.isOpen(n),$=q.getResultId(n),I=document.getElementById(`gif-cancel-${n}`),x=document.getElementById(`form-inner-${n}`);if(i&&$&&I.classList.replace("d-flex","d-none"),n&&!i&&y.base64Encode(x.value)===x.getAttribute("data-original")&&v===l){k(n);return}x&&(x.disabled=!0);let P=document.querySelector(`[onclick="undangan.comment.cancel('${n}')"]`);P&&(P.disabled=!0);let M=y.disableButton(t),_=await C(Z,"/api/comment/"+d.get(n)).token(A.getToken()).body(O.updateCommentRequest(g?l:null,q.isOpen(n)?null:x.value,$)).send(O.statusResponse).then(H=>H.data.status,()=>!1);if(x&&(x.disabled=!1),P&&(P.disabled=!1),g&&(g.disabled=!1),M.restore(),i&&$&&I.classList.replace("d-none","d-flex"),!!_){if(i&&$&&(document.getElementById(`img-gif-${n}`).src=document.getElementById(`gif-result-${n}`)?.querySelector("img").src,I.dispatchEvent(new Event("click"))),k(n),!i){let H=document.querySelector(`[onclick="undangan.comment.showMore(this, '${n}')"]`),N=F.convertMarkdownToHTML(y.escapeHtml(x.value)),z=document.getElementById(`content-${n}`);N.length>F.maxCommentLength?(z.innerHTML=H?.getAttribute("data-show")==="false"?N.slice(0,F.maxCommentLength)+"...":N,z.setAttribute("data-comment",y.base64Encode(N)),H?.classList.replace("d-none","d-block")):(z.innerHTML=N,z.removeAttribute("data-comment"),H?.classList.replace("d-block","d-none"))}if(g&&(document.getElementById("form-presence").value=l?"1":"2",S("information").set("presence",l)),!(!g||!e)){if(l){e.classList.remove("fa-circle-xmark","text-danger"),e.classList.add("fa-circle-check","text-success");return}e.classList.remove("fa-circle-check","text-success"),e.classList.add("fa-circle-xmark","text-danger")}}},cancel:t=>{let n=document.getElementById(`form-inner-presence-${t}`),l=n?n.value==="1":!1,g=document.getElementById(`badge-${t}`),v=g&&d.has(t)?g.classList.contains("text-success"):!1;if(q.isOpen(t)&&(!q.getResultId(t)&&v===l||confirm("Are you sure?"))&&q.remove(t).then(()=>k(t)),!q.isOpen(t)){let e=document.getElementById(`form-inner-${t}`);(e.value.length===0||y.base64Encode(e.value)===e.getAttribute("data-original")&&v===l||confirm("Are you sure?"))&&k(t)}},show:u,showMore:(t,n)=>{let l=document.getElementById(`content-${n}`),g=y.base64Decode(l.getAttribute("data-comment")),v=t.getAttribute("data-show")==="false";l.innerHTML=v?g:g.slice(0,F.maxCommentLength)+"...",t.innerText=v?"Sebagian":"Selengkapnya",t.setAttribute("data-show",v?"true":"false")},showOrHide:w}})();var re=(()=>{let d=()=>X.getDetailUser().then(r=>{document.getElementById("dashboard-name").innerHTML=`${y.escapeHtml(r.data.name)}<i class="fa-solid fa-hands text-warning ms-2"></i>`,document.getElementById("dashboard-email").innerHTML=r.data.email,document.getElementById("dashboard-accesskey").value=r.data.access_key,document.getElementById("button-copy-accesskey").setAttribute("data-copy",r.data.access_key),document.getElementById("form-name").value=y.escapeHtml(r.data.name),document.getElementById("filterBadWord").checked=!!r.data.is_filter,document.getElementById("replyComment").checked=!!r.data.can_reply,document.getElementById("editComment").checked=!!r.data.can_edit,document.getElementById("deleteComment").checked=!!r.data.can_delete,document.getElementById("dashboard-tenorkey").value=r.data.tenor_key,S("config").set("tenor_key",r.data.tenor_key)}),h=()=>{C(j,"/api/stats").token(A.getToken()).send().then(r=>{document.getElementById("count-comment").innerHTML=String(r.data.comments).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-like").innerHTML=String(r.data.likes).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-present").innerHTML=String(r.data.present).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-absent").innerHTML=String(r.data.absent).replace(/\B(?=(\d{3})+(?!\d))/g,".")})},b=async r=>{let p=y.disableCheckbox(r);await C(V,"/api/user").token(A.getToken()).body({filter:!!r.checked}).send(),p.restore()},o=async r=>{let p=y.disableCheckbox(r);await C(V,"/api/user").token(A.getToken()).body({can_reply:!!r.checked}).send(),p.restore()},f=async r=>{let p=y.disableCheckbox(r);await C(V,"/api/user").token(A.getToken()).body({can_edit:!!r.checked}).send(),p.restore()},s=async r=>{let p=y.disableCheckbox(r);await C(V,"/api/user").token(A.getToken()).body({can_delete:!!r.checked}).send(),p.restore()},c=async r=>{let p=y.disableButton(r),L=document.getElementById("dashboard-tenorkey");L.disabled=!0,await C(V,"/api/user").token(A.getToken()).body({tenor_key:L.value.length?L.value:null}).send().then(()=>alert(`success ${L.value.length?"add":"remove"} tenor key`)),L.disabled=!1,p.restore()},m=async r=>{if(!confirm("Are you sure?"))return;let p=y.disableButton(r);await C(Z,"/api/key").token(A.getToken()).send(O.statusResponse).then(L=>{L.data.status&&d()}),p.restore()},k=async r=>{let p=document.getElementById("old_password"),L=document.getElementById("new_password");if(p.value.length===0||L.value.length===0){alert("Password cannot be empty");return}p.disabled=!0,L.disabled=!0;let U=y.disableButton(r),D=await C(V,"/api/user").token(A.getToken()).body({old_password:p.value,new_password:L.value}).send(O.statusResponse).then(J=>J.data.status,()=>!1);U.restore(!0),p.disabled=!1,L.disabled=!1,D&&(p.value=null,L.value=null,alert("Success change password"))},T=async r=>{let p=document.getElementById("form-name");if(p.value.length===0){alert("Name cannot be empty");return}p.disabled=!0;let L=y.disableButton(r),U=await C(V,"/api/user").token(A.getToken()).body({name:p.value}).send(O.statusResponse).then(D=>D.data.status,()=>!1);p.disabled=!1,L.restore(!0),U&&(d(),alert("Success change name"))},B=async r=>{let p=y.disableButton(r);await C(j,"/api/download").token(A.getToken()).download(),p.restore()},a=()=>{let r=document.getElementById("button-change-name");r.disabled&&(r.disabled=!1)},u=()=>{let r=document.getElementById("button-change-password"),p=document.getElementById("old_password");r.disabled&&p.value.length!==0&&(r.disabled=!1)},w=()=>{confirm("Are you sure?")&&X.clearSession()},E=()=>{ae.init(),te.spyTop();let r=async()=>{await d(),h(),ne.init(),ne.show()};document.addEventListener("hidden.bs.modal",r);try{let p=window.location.href.split("?k=");p.length>1&&p[1].length>=1&&(A.setToken(p[1]),window.history.replaceState({},document.title,p[0]));let L=A.decode()?.exp;if(!L||L<Date.now()/1e3)throw new Error("Invalid token");r()}catch{X.clearSession()}};return{init:()=>(X.init(),te.init(),A.init(),A.isAdmin()||(S("owns").clear(),S("likes").clear(),S("config").clear(),S("comment").clear(),S("session").clear(),S("information").clear()),window.addEventListener("DOMContentLoaded",E),{util:y,theme:te,comment:ne,admin:{auth:X,navbar:oe,logout:w,tenor:c,download:B,regenerate:m,editComment:f,replyComment:o,deleteComment:s,changeName:T,changePassword:k,changeFilterBadWord:b,enableButtonName:a,enableButtonPassword:u}})}})();(d=>{d.undangan=re.init()})(window);})();
